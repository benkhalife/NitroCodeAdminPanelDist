import{h as r,g as n,d as e,f as B,x as j,u as P,r as U,o as I,y as N,j as S,z as w,m as g,F as z,l as D,q as L,t as Z,b,w as C,k as f,A as $,S as F,e as v,v as h,B as O,c as M,C as R,P as q}from"./index-B9xW4oto.js";import{_ as H}from"./TextEditor-YSRyILtV.js";import{_ as G}from"./TitleBar-DTLCMzoY.js";import{u as K}from"./sidebar-C79XLyyG.js";import{r as J}from"./PhotoIcon-BDQ3OBka.js";import{r as Q}from"./TrashIcon-MEhX_Sun.js";import{r as W}from"./PlusIcon-CubkhCq9.js";class X{prevent_default=!0;listen_keys=[];active_timer=!1;timer=1e3;event_type="keydown";timeoutid=null;listeners={};constructor(s){return this.controll_key=s,this}setPreventDefault(s){return this.prevent_default=s,this}setEventType(s="keydown"){return this.event_type=s,this}check(s,d){return!!(s[this.controll_key+"Key"]&&(Array.isArray(d)&&d.indexOf(s.key)>-1||typeof d=="string"&&s.key==d))}runTimer(){this.active_timer==!1&&(this.active_timer=!0,this.timeoutid=setTimeout(()=>{this.active_timer=!1,this.listen_keys=[]},this.timer))}listen(s,d,a){const _=c=>this.action(c,d,a);return this.listeners[s]=_,document.addEventListener(this.event_type,this.listeners[s]),this}listenMulti(s,d,a){const _=c=>this.multiAction(c,[...d,a]);return this.listeners[s]=_,document.addEventListener(this.event_type,this.listeners[s]),this}remove(s){document.removeEventListener(this.event_type,this.listeners[s])}removeAll(){Object.keys(this.listeners).forEach(s=>{this.remove(s)})}action(s,d,a){this.check(s,d)&&(this.prevent_default&&s.preventDefault(),a())}multiAction(s,d=[]){if(s){var a=null;this.runTimer();for(const c of d)if(typeof c=="function"){a=c;continue}else if(s.key.toLowerCase()==this.controll_key){this.prevent_default&&s.preventDefault();continue}else this.check(s,c)&&this.listen_keys.indexOf(s.key)==-1&&(this.prevent_default&&s.preventDefault(),this.listen_keys.push(s.key));if(a==null)throw"callback is not defined";var _=0;for(const c of this.listen_keys)for(const y of d)(Array.isArray(y)&&c.indexOf(c)>-1||typeof y=="string"&&c==y)&&(_+=1);this.listen_keys.length==d.length-1&&_==d.length-1&&(this.listen_keys=[],clearTimeout(this.timeoutid),this.active_timer=!1,a())}}}function Y(k,s){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M11.013 2.513a1.75 1.75 0 0 1 2.475 2.474L6.226 12.25a2.751 2.751 0 0 1-.892.596l-2.047.848a.75.75 0 0 1-.98-.98l.848-2.047a2.75 2.75 0 0 1 .596-.892l7.262-7.261Z","clip-rule":"evenodd"})])}function ee(k,s){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M5 3.25V4H2.75a.75.75 0 0 0 0 1.5h.3l.815 8.15A1.5 1.5 0 0 0 5.357 15h5.285a1.5 1.5 0 0 0 1.493-1.35l.815-8.15h.3a.75.75 0 0 0 0-1.5H11v-.75A2.25 2.25 0 0 0 8.75 1h-1.5A2.25 2.25 0 0 0 5 3.25Zm2.25-.75a.75.75 0 0 0-.75.75V4h3v-.75a.75.75 0 0 0-.75-.75h-1.5ZM6.05 6a.75.75 0 0 1 .787.713l.275 5.5a.75.75 0 0 1-1.498.075l-.275-5.5A.75.75 0 0 1 6.05 6Zm3.9 0a.75.75 0 0 1 .712.787l-.275 5.5a.75.75 0 0 1-1.498-.075l.275-5.5a.75.75 0 0 1 .786-.711Z","clip-rule":"evenodd"})])}const te={class:"w-full flex flex-col gap-4 rounded-lg bg-base-200 p-2 lg:p-4"},se={class:"flex justify-between gap-4 items-center"},le={key:0,class:"border-4 border-dashed border-primary/20 rounded-xl mt-8 text-center p-10 text-xl text-primary/60 font-bold"},ie={key:1},oe={key:0,class:"border-4 border-dashed border-primary/20 rounded-xl mt-8 text-center p-10"},ne={class:"mt-8 text-center"},ae={class:"flex flex-col gap-4 mt-10"},re={class:"flex items-center gap-3"},de={key:0},ue={key:1},ce={class:"text-xl"},pe={class:"flex items-center gap-2"},fe=["onClick"],me={__name:"AdminEpisodesListManage",props:{product:{default:{id:0}}},setup(k){const s=new X("alt"),d=B(),a=j(),_=P(),c=U([]),y=k,m=()=>{$.post("admin/product/episodes-list",{product_id:a.params.id}).then(p=>{p.ok&&(c.value=p.episodes)})},l=()=>{const p=d.resolve({name:"admin_product_episode_new",params:{product_id:y.product.id}});window.open(p.href,"_blank")};I(()=>{m(),s.listen("add_episode","a",()=>{l()}),s.listen("reload_episodes","r",()=>{m()})});const V=p=>!(p.publish==!1||p.publish=="0"),A=p=>{F.fire({title:p.title,text:"آیا از حذف این بخش اطمینان دارید؟",icon:"warning",showCancelButton:!0,confirmButtonText:"حذف کن",cancelButtonText:"لغو"}).then(o=>{o.isConfirmed&&T(p)})},T=p=>{$.post("admin/product/episode-remove",{episode_id:p.id}).then(()=>{_.showToast("قسمت با موفقیت حذف شد"),m()})};return N(()=>{s.removeAll()}),(p,o)=>{const t=S("router-link");return n(),r("div",te,[e("div",se,[o[2]||(o[2]=e("div",{class:"text-xl font-bold"},"لیست قسمت های محصول",-1)),e("div",null,[e("button",{onClick:o[0]||(o[0]=u=>l()),class:"btn btn-primary"},"ایجاد قسمت")])]),k.product.id==0||!k.product.id?(n(),r("div",le,o[3]||(o[3]=[w(" لطفا ابتدا اطلاعات اولیه محصول را ذخیره کنید و سپس به این قسمت مراجعه نمایید "),e("div",{class:"text-primary text-4xl mt-8"},"😅",-1)]))):(n(),r("div",ie,[c.value.length==0?(n(),r("div",oe,[o[5]||(o[5]=e("div",{class:"text-xl text-primary/60 font-bold"}," هنوز محتوایی اضافه نشده است ",-1)),e("div",ne,[e("button",{onClick:o[1]||(o[1]=u=>l()),class:"btn btn-xl btn-primary"}," افزودن قسمت جدید "),o[4]||(o[4]=e("div",{dir:"ltr",class:"mt-4"},[e("kbd",{class:"kbd"},"alt"),w(" + "),e("kbd",{class:"kbd"},"A")],-1))])])):g("",!0),e("div",ae,[(n(!0),r(z,null,D(c.value,u=>(n(),r("div",{class:L([{"opacity-70":V(u)==!1},"p-4 rounded-xl bg-base-100 flex justify-between items-center"]),key:u.id},[e("div",re,[V(u)==!1?(n(),r("div",de,"⚠️")):(n(),r("div",ue,"✳️")),e("div",ce,Z(u.title),1)]),e("div",pe,[b(t,{target:"_blank",to:{name:"admin_product_episode_edit",params:{product_id:f(a).params.id,episode_id:u.id}},class:"cursor-pointer p-1 hover:scale-105 duration-200 hover:bg-primary/40 rounded-xl text-primary bg-primary/20"},{default:C(()=>[b(f(Y),{class:"size-8"})]),_:2},1032,["to"]),e("button",{onClick:i=>A(u),class:"cursor-pointer p-1 hover:scale-105 duration-200 hover:bg-primary/20 rounded-xl text-warning"},[b(f(ee),{class:"size-8"})],8,fe)])],2))),128))])]))])}}},ve={role:"tablist",class:"tabs tabs-box"},_e={key:0,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},he={class:"w-full flex flex-col gap-4 rounded-lg bg-base-200 p-2 lg:p-4"},ge={class:"fieldset"},be={class:"grid grid-cols-1 lg:grid-cols-2 gap-2 lg:gap-4"},ye={class:"flex gap-1 items-end"},xe={class:"fieldset flex-1"},ke={class:"join"},we={class:"fieldset"},$e={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ce={class:"fieldset"},Ve={class:"fieldset"},Ae={class:"fieldset"},Te={class:""},Ue={class:"rounded-lg bg-base-200 p-2 lg:p-4 flex flex-col gap-4 lg:min-w-sm"},Le={class:"text-center"},Me={class:"mt-4"},Ee=["src"],Be={key:1,class:"mx-auto"},je={class:"fieldset bg-base-100 border-base-300 rounded-box w-64 border p-4 lg:mt-auto w-full"},Pe={class:"label"},Se=["checked"],ze={key:1,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},De={key:2,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},Ie={class:"w-full flex flex-col gap-4 rounded-lg bg-base-200 p-2 lg:p-4"},Ne={class:"flex gap-4 items-end"},Ze={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 flex-1 gap-4 items-center"},Fe={class:"col-span-1 sm:col-span-3 md:col-span-1 fieldset flex items-center"},Oe=["onUpdate:modelValue"],Re=["onUpdate:modelValue"],qe={class:"col-span-1 fieldset"},He=["onUpdate:modelValue"],Ge={class:"col-span-1 fieldset"},Ke=["onUpdate:modelValue"],Je={class:"flex gap-2"},Qe=["onClick"],it={__name:"ProductManageView",setup(k){const s=K(),d=P(),a=j(),_=B(),c=async()=>{const o=await $.post("admin/product/info",{id:a.params.id});o.ok&&(l.value=o.product,m.value=o.inventorys,l.value.publish===1||l.value.publish==="1"?l.value.publish=!0:l.value.publish=!1)},y=U(null),m=U([]),l=U({}),V=()=>{l.value.link=q(l.value.title)},A=()=>{m.value.push({name:"",price:0,count:1})};A();const T=async()=>{const o=await $.post("admin/product/save",{...l.value,inventorys:m.value});o.ok&&(d.showToast("عملیات با موفقیت انجام شد!","success"),a.name=="admin_product_new"&&(await _.push({name:"admin_product_edit",params:{id:o.product.id}}),c()))},p=o=>{const t=o.target.files[0];$.uploadFile("admin/product/upload-image",t,{},u=>{console.log(u)},u=>{console.log(u),u.ok&&(l.value.image=u.dir)},u=>{})};return a.name=="admin_product_new"?s.setTitle("ایجاد محصول جدید"):(s.setTitle("ویرایش محصول"),c()),(o,t)=>{const u=S("RouterLink");return n(),r("div",null,[b(G,{title:f(s).getTitle},{default:C(()=>[e("div",ve,[b(u,{to:{hash:""},role:"tab",class:L(["tab",{"tab-active tab-primary":f(a).hash==""}])},{default:C(()=>t[10]||(t[10]=[w(" اطلاعات محصول ")])),_:1,__:[10]},8,["class"]),l.value.content_type=="physical"?(n(),M(u,{key:0,to:{hash:"#inventory"},class:L([{"tab-active ":f(a).hash=="#inventory"},"tab"]),role:"tab"},{default:C(()=>t[11]||(t[11]=[w("موجودی محصول")])),_:1,__:[11]},8,["class"])):g("",!0),l.value.content_type=="media"?(n(),M(u,{key:1,to:{hash:"#episodes"},class:L([{"tab-active":f(a).hash=="#episodes"},"tab"]),role:"tab"},{default:C(()=>t[12]||(t[12]=[w("قسمت های محصول")])),_:1,__:[12]},8,["class"])):g("",!0)])]),_:1},8,["title"]),f(a).hash==""?(n(),r("div",_e,[e("div",he,[e("fieldset",ge,[t[13]||(t[13]=e("legend",{class:"fieldset-legend"},"عنوان محصول",-1)),v(e("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>l.value.title=i),class:"input input-primary w-full",type:"text",placeholder:"عنوان محصول"},null,512),[[h,l.value.title]])]),e("div",be,[e("div",ye,[e("fieldset",xe,[t[14]||(t[14]=e("legend",{class:"fieldset-legend"},"لینک محصول",-1)),e("div",ke,[e("button",{onClick:t[1]||(t[1]=i=>V()),class:"btn btn-secondary opacity-50 join-item"},"G/A"),v(e("input",{class:"join-item input",type:"text","onUpdate:modelValue":t[2]||(t[2]=i=>l.value.link=i),placeholder:"لینک محصول"},null,512),[[h,l.value.link]])])])]),e("fieldset",we,[t[16]||(t[16]=e("legend",{class:"fieldset-legend"}," نوع محتوای محصول ",-1)),v(e("select",{"onUpdate:modelValue":t[3]||(t[3]=i=>l.value.content_type=i),class:"select select-primary w-full"},t[15]||(t[15]=[e("option",{value:"physical"},"محتوای فیزیکی",-1),e("option",{value:"media"},"محتوای رسانه/ویدیو/دوره آموزشی",-1)]),512),[[O,l.value.content_type]])])]),l.value.content_type=="media"?(n(),r("div",$e,[e("fieldset",Ce,[t[17]||(t[17]=e("legend",{class:"fieldset-legend"},"قیمت اصلی",-1)),v(e("input",{dir:"ltr","onUpdate:modelValue":t[4]||(t[4]=i=>l.value.price=i),class:"input input-primary w-full",type:"number",placeholder:""},null,512),[[h,l.value.price]])]),e("fieldset",Ve,[t[18]||(t[18]=e("legend",{class:"fieldset-legend"},"قیمت نمایشی (برای تخفیف باید بیشتر از قیمت اصلی باشد)",-1)),v(e("input",{dir:"ltr","onUpdate:modelValue":t[5]||(t[5]=i=>l.value.show_price=i),class:"input input-primary w-full",type:"number",placeholder:""},null,512),[[h,l.value.show_price]])])])):g("",!0),e("div",null,[e("fieldset",Ae,[t[19]||(t[19]=e("legend",{class:"fieldset-legend"},"توضیحات کوتاه",-1)),v(e("input",{"onUpdate:modelValue":t[6]||(t[6]=i=>l.value.small_description=i),class:"input input-primary w-full",type:"text",placeholder:""},null,512),[[h,l.value.small_description]])])]),e("div",Te,[t[20]||(t[20]=e("legend",{class:"fieldset-legend"},"توضیحات",-1)),(n(),M(H,{key:l.value.id,value:l.value.description,onInput:t[7]||(t[7]=i=>l.value.description=i)},null,8,["value"]))])]),e("div",Ue,[e("div",Le,[e("input",{onChange:p,ref_key:"upload_main_image",ref:y,accept:".png, .jpg, .webp",type:"file",class:"hidden"},null,544),e("div",Me,[l.value.image?(n(),r("img",{key:0,class:"max-w-72 w-full h-full mx-auto rounded-lg",src:f($).server+l.value.image,alt:""},null,8,Ee)):(n(),r("div",Be,[b(f(J),{class:"mx-auto size-32"})]))]),e("button",{class:"btn btn-primary mt-4",onClick:t[8]||(t[8]=i=>y.value.click())}," آپلود عکس محصول ")]),e("fieldset",je,[e("label",Pe,[v(e("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=i=>l.value.publish=i),checked:l.value.publish,class:"checkbox checkbox-success"},null,8,Se),[[R,l.value.publish]]),t[21]||(t[21]=w(" انتشار محصول "))])]),e("div",{class:"text-center"},[e("button",{onClick:T,class:"btn btn-success"}," ذخیره محصول ")])])])):g("",!0),f(a).hash=="#episodes"?(n(),r("div",ze,[b(me,{product:l.value},null,8,["product"])])):g("",!0),f(a).hash=="#inventory"?(n(),r("div",De,[e("div",Ie,[t[25]||(t[25]=e("div",{class:"text-xl font-bold"},"موجودی محصول",-1)),(n(!0),r(z,null,D(m.value,(i,E)=>(n(),r("div",Ne,[e("div",Ze,[e("fieldset",Fe,[t[22]||(t[22]=e("legend",{class:"fieldset-legend"},"مدل/رنگ",-1)),v(e("input",{class:"color",style:{width:"40px",height:"40px","border-radius":"30px"},type:"color","onUpdate:modelValue":x=>i.color=x},null,8,Oe),[[h,i.color]]),v(e("input",{"onUpdate:modelValue":x=>i.name=x,class:"input input-primary w-full"},null,8,Re),[[h,i.name]])]),e("fieldset",qe,[t[23]||(t[23]=e("legend",{class:"fieldset-legend"},"قیمت",-1)),v(e("input",{"onUpdate:modelValue":x=>i.price=x,class:"input input-primary w-full"},null,8,He),[[h,i.price]])]),e("fieldset",Ge,[t[24]||(t[24]=e("legend",{class:"fieldset-legend"},"موجودی",-1)),v(e("input",{"onUpdate:modelValue":x=>i.quantity=x,class:"input input-primary w-full"},null,8,Ke),[[h,i.quantity]])])]),e("div",Je,[m.value.length>1?(n(),r("button",{key:0,onClick:x=>m.value.splice(E,1),class:"cursor-pointer p-2 border-error hover:bg-error/20 duration-200 text-error rounded-lg border-1"},[b(f(Q),{class:"size-6"})],8,Qe)):g("",!0),E==m.value.length-1?(n(),r("button",{key:1,onClick:A,class:"cursor-pointer hover:bg-info/20 duration-200 p-2 rounded-lg border-1"},[b(f(W),{class:"size-6"})])):g("",!0)])]))),256)),e("div",{class:"text-center"},[e("button",{onClick:T,class:"btn btn-success"}," ذخیره موجودی محصول ")])])])):g("",!0)])}}};export{it as default};
