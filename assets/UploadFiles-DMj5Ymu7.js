import{r as v,B as C,h as n,g as l,d as t,m as u,z as H,t as d,G as y,q as h,F,l as B,A as U,S as K}from"./index-CmSqWVxV.js";const Q={class:"w-full max-w-2xl mx-auto"},J={class:"flex flex-col items-center justify-center space-y-3"},R={class:"text-sm text-gray-500 mt-1"},W={key:0,class:"text-sm text-blue-500 mt-1"},X={key:0,class:"mt-6 space-y-3",dir:"ltr"},Y={class:"flex items-center justify-between"},Z={class:"flex items-center space-x-3 flex-1"},ee={class:"flex-1"},te={class:"font-medium text-gray-800 truncate max-w-xs"},se={class:"text-sm text-gray-500 flex gap-4"},re={key:0},oe={class:"flex-1"},ne=["value"],le={class:"flex items-center space-x-2"},ae={key:0,class:"w-8 h-8"},ie={key:1,class:"w-8 h-8"},de={key:2,class:"w-8 h-8"},ue={key:0,class:"mt-2 text-red-500 text-sm"},ce={key:1,class:"mt-4 flex gap-2"},pe={key:2,class:"mt-4 p-4 bg-blue-50 rounded-lg"},ve={class:"flex items-center justify-between"},me={class:"text-sm text-blue-600"},ge={key:3,class:"mt-8",dir:"ltr"},xe={class:"space-y-2"},fe={class:"flex items-center space-x-3"},he={class:"font-medium text-gray-700 truncate"},be={class:"flex gap-4 justify-end"},we=["onClick"],ye=["onClick"],ke=["onClick"],_e=["onClick"],Ce={class:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-4"},Fe={class:"flex items-center space-x-3"},Be={class:"font-medium text-sm text-gray-700 truncate"},Ue=["onClick"],Ve={__name:"UploadFiles",props:{uploadLink:{type:String,required:!0},episode:{required:!0},fetchFilesUrl:{type:String,required:!0},deleteFileUrl:{type:String,required:!0,default:"admin/product/delete-episode-file"}},emits:["setVideo","setVideoPoster"],setup(b,{emit:Me}){const c=b,M=v(null),m=v(!1),o=v([]),g=v([]),p=v(!1),x=v(-1),w=v(!1),A=C(()=>o.value.filter(r=>r.status==="pending").length),D=C(()=>o.value.filter(r=>r.status==="success").length),L=C(()=>o.value.filter(r=>r.status==="error").length),k=async()=>{try{const r=await U.post(c.fetchFilesUrl,{id:c.episode.id});r.ok&&Array.isArray(r.files)?g.value=r.files.map(s=>({name:s.name,id:s.name})):g.value=[]}catch(r){console.error("Failed to fetch existing files:",r),g.value=[]}};k();const $=()=>{M.value.click()},I=r=>{r.preventDefault(),m.value=!0},j=r=>{r.preventDefault(),m.value=!1;const s=Array.from(r.dataTransfer.files);S(s)},P=r=>{const s=Array.from(r.target.files);S(s),r.target.value=""},S=r=>{const s=r.map(e=>({id:Date.now()+Math.random(),name:e.name,size:e.size,file:e,progress:0,status:"pending",error:null}));o.value.push(...s)},T=async()=>{if(p.value)return;p.value=!0,w.value=!1,x.value=-1;const r=o.value.filter(s=>s.status==="pending");for(let s=0;s<r.length&&!w.value;s++){x.value=o.value.findIndex(e=>e.id===r[s].id);try{await E(r[s])}catch(e){console.error("Upload stopped due to error:",e);break}await new Promise(e=>setTimeout(e,100))}p.value=!1,x.value=-1,w.value||await k()},q=()=>{w.value=!0,p.value=!1},E=r=>new Promise((s,e)=>{const a=o.value.findIndex(i=>i.id===r.id);if(a===-1){e(new Error("File not found"));return}o.value[a]={...o.value[a],status:"uploading",progress:0},U.uploadFile(c.uploadLink,r.file,{id:c.episode.id},i=>{a!==-1&&(o.value[a]={...o.value[a],progress:parseInt(i)})},i=>{if(console.log("resp",i),i.ok&&i.status)o.value[a]={...o.value[a],status:"success",progress:100},s(i);else{const f=i.error||"Upload failed";o.value[a]={...o.value[a],status:"error",error:f},e(new Error(f))}},i=>{o.value[a]={...o.value[a],status:"error",error:"Network error occurred"},e(new Error("Network error occurred"))})}),N=()=>{o.value=o.value.filter(r=>r.status==="pending")},O=()=>{o.value=[]},_=(r,s)=>{const e=r.toLowerCase().split(".").pop();return s.indexOf(e)>-1},G=(r,s=2)=>{if(r===0)return"0 Bytes";const e=1024,a=s<0?0:s,i=["Bytes","KB","MB","GB"],f=Math.floor(Math.log(r)/Math.log(e));return parseFloat((r/Math.pow(e,f)).toFixed(a))+" "+i[f]},V=r=>{const s=["mp4","mp3","m4a","png","jpg","mpd","webp"],e=r.toLowerCase().split(".").pop();return s.indexOf(e)>-1},z=async r=>{(await K.fire({title:"آیا مطمئن هستید؟",text:`آیا از حذف فایل "${r.name}" اطمینان دارید؟`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"بله، حذف شود",cancelButtonText:"لغو"})).isConfirmed&&(console.log(c.episode),(await U.post(c.deleteFileUrl,{file_name:r.name,id:c.episode.id})).ok&&k())};return(r,s)=>(l(),n("div",Q,[t("div",{class:h(["relative border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all duration-300",{"border-blue-500 bg-blue-50":m.value,"border-gray-300 hover:border-gray-400 hover:bg-gray-50":!m.value}]),onDragover:y(I,["prevent"]),onDragenter:s[0]||(s[0]=y(e=>m.value=!0,["prevent"])),onDragleave:s[1]||(s[1]=y(e=>m.value=!1,["prevent"])),onDrop:y(j,["prevent"]),onClick:$},[t("input",{ref_key:"fileInput",ref:M,type:"file",multiple:"",class:"hidden",onChange:P},null,544),t("div",J,[s[3]||(s[3]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),t("div",null,[s[2]||(s[2]=t("p",{class:"font-medium text-gray-700"},[t("span",{class:"text-blue-600 font-semibold"},"Click to upload"),H(" or drag and drop ")],-1)),t("p",R," Supports multiple files ("+d(o.value.length)+" selected) ",1),p.value?(l(),n("p",W," Uploading... "+d(x.value+1)+"/"+d(o.value.length),1)):u("",!0)])])],34),o.value.length>0?(l(),n("div",X,[(l(!0),n(F,null,B(o.value,(e,a)=>(l(),n("div",{key:e.id,class:h(["border rounded-lg p-4 bg-white shadow-sm",{"border-blue-200 bg-blue-50":e.status==="uploading","border-green-200 bg-green-50":e.status==="success","border-red-200 bg-red-50":e.status==="error"}])},[t("div",Y,[t("div",Z,[s[4]||(s[4]=t("div",{class:"bg-gray-100 p-2 rounded-lg"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),t("div",ee,[t("p",te,d(e.name),1),t("div",se,[t("div",null,[t("span",null,d(G(e.size)),1)]),e.progress>0?(l(),n("div",re,[t("span",null,d(e.progress)+"%",1)])):u("",!0),t("div",oe,[t("progress",{class:"progress progress-primary w-full",value:e.progress,max:"100"},null,8,ne)])])])]),t("div",le,[e.status==="uploading"?(l(),n("div",ae,s[5]||(s[5]=[t("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"},null,-1)]))):e.status==="error"?(l(),n("div",ie,s[6]||(s[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)]))):e.status==="success"?(l(),n("div",de,s[7]||(s[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)]))):u("",!0)])]),e.status==="error"?(l(),n("div",ue,d(e.error),1)):u("",!0)],2))),128))])):u("",!0),o.value.length>0&&!p.value?(l(),n("div",ce,[t("button",{onClick:T,class:"btn btn-primary"}," Start Upload ("+d(A.value)+" files) ",1),t("button",{onClick:N,class:"btn btn-outline"}," Clear Completed "),t("button",{onClick:O,class:"btn btn-outline"}," Clear All ")])):u("",!0),p.value?(l(),n("div",pe,[t("div",ve,[t("div",null,[s[8]||(s[8]=t("p",{class:"font-medium text-blue-700"},"Uploading in progress...",-1)),t("p",me,d(x.value+1)+" of "+d(o.value.length)+" files ("+d(D.value)+" successful, "+d(L.value)+" failed) ",1)]),t("button",{onClick:q,class:"btn btn-sm btn-outline text-red-600"}," Stop Upload ")])])):u("",!0),g.value.length>0?(l(),n("div",ge,[s[10]||(s[10]=t("h3",{class:"text-lg font-medium text-gray-200 mb-3"},"Uploaded Files",-1)),t("div",xe,[(l(!0),n(F,null,B(g.value.filter(e=>V(e.name)===!0),(e,a)=>(l(),n("div",{key:e.id||e.name,class:"p-3 bg-gray-50 rounded-lg border flex flex-col gap-4"},[t("div",fe,[s[9]||(s[9]=t("div",{class:"bg-gray-200 p-2 rounded"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),t("span",he,d(e.name),1)]),t("div",be,[_(e.name,["mpd","mp4"])?(l(),n("button",{key:0,onClick:i=>r.$emit("setVideo",e),class:h([{"btn-primary":e.name==b.episode.video_target},"btn btn-sm"])}," Set Video ",10,we)):u("",!0),_(e.name,["png","jpg","webp"])?(l(),n("button",{key:1,onClick:i=>r.$emit("setVideoPoster",e),class:h([{"btn-primary":e.name==b.episode.video_poster},"btn btn-sm"])}," Set Video Poster ",10,ye)):u("",!0),_(e.name,["mp3","m4a"])?(l(),n("button",{key:2,onClick:i=>r.$emit("setAudio",e),class:h([{"btn-primary":e.name==b.episode.audio},"btn btn-sm"])}," Set Post Audio ",10,ke)):u("",!0),t("button",{onClick:i=>z(e),class:"btn btn-sm btn-warning btn-outline"},"delete",8,_e)])]))),128)),t("div",Ce,[(l(!0),n(F,null,B(g.value.filter(e=>V(e.name)===!1),(e,a)=>(l(),n("div",{key:e.id||e.name,class:"p-3 bg-gray-50 rounded-lg border opacity-50"},[t("div",Fe,[t("span",Be,d(e.name),1)]),t("div",null,[t("button",{onClick:i=>z(e),class:"btn btn-sm btn-warning btn-outline"},"delete",8,Ue)])]))),128))])])])):u("",!0)]))}};export{Ve as _};
