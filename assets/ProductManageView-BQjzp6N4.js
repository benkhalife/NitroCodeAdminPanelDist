import{h as r,g as i,d as e,f as E,x as z,u as j,r as B,o as N,y as Z,j as I,z as w,m as b,F as L,l as P,q as T,t as D,b as h,w as C,k as p,A as $,S as O,B as R,P as q,e as m,v as g,C as F,c as M,D as H,E as G,G as K}from"./index-BgbRNVau.js";import{_ as J}from"./TextEditor-BVsPOJT_.js";import{_ as Q}from"./TitleBar-GDK6WCn_.js";import{u as W}from"./sidebar-CH8H9QsY.js";import{r as X,_ as Y}from"./PluginFormBuilder-BqmQ3Wnh.js";import{r as ee}from"./TrashIcon-C3xsdaFq.js";import{r as te}from"./PlusIcon-CkED7Mti.js";import"./ComInput-BbDURKFN.js";class se{prevent_default=!0;listen_keys=[];active_timer=!1;timer=1e3;event_type="keydown";timeoutid=null;listeners={};constructor(s){return this.controll_key=s,this}setPreventDefault(s){return this.prevent_default=s,this}setEventType(s="keydown"){return this.event_type=s,this}check(s,u){return!!(s[this.controll_key+"Key"]&&(Array.isArray(u)&&u.indexOf(s.key)>-1||typeof u=="string"&&s.key==u))}runTimer(){this.active_timer==!1&&(this.active_timer=!0,this.timeoutid=setTimeout(()=>{this.active_timer=!1,this.listen_keys=[]},this.timer))}listen(s,u,a){const _=c=>this.action(c,u,a);return this.listeners[s]=_,document.addEventListener(this.event_type,this.listeners[s]),this}listenMulti(s,u,a){const _=c=>this.multiAction(c,[...u,a]);return this.listeners[s]=_,document.addEventListener(this.event_type,this.listeners[s]),this}remove(s){document.removeEventListener(this.event_type,this.listeners[s])}removeAll(){Object.keys(this.listeners).forEach(s=>{this.remove(s)})}action(s,u,a){this.check(s,u)&&(this.prevent_default&&s.preventDefault(),a())}multiAction(s,u=[]){if(s){var a=null;this.runTimer();for(const c of u)if(typeof c=="function"){a=c;continue}else if(s.key.toLowerCase()==this.controll_key){this.prevent_default&&s.preventDefault();continue}else this.check(s,c)&&this.listen_keys.indexOf(s.key)==-1&&(this.prevent_default&&s.preventDefault(),this.listen_keys.push(s.key));if(a==null)throw"callback is not defined";var _=0;for(const c of this.listen_keys)for(const y of u)(Array.isArray(y)&&c.indexOf(c)>-1||typeof y=="string"&&c==y)&&(_+=1);this.listen_keys.length==u.length-1&&_==u.length-1&&(this.listen_keys=[],clearTimeout(this.timeoutid),this.active_timer=!1,a())}}}function le(k,s){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M11.013 2.513a1.75 1.75 0 0 1 2.475 2.474L6.226 12.25a2.751 2.751 0 0 1-.892.596l-2.047.848a.75.75 0 0 1-.98-.98l.848-2.047a2.75 2.75 0 0 1 .596-.892l7.262-7.261Z","clip-rule":"evenodd"})])}function oe(k,s){return i(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M5 3.25V4H2.75a.75.75 0 0 0 0 1.5h.3l.815 8.15A1.5 1.5 0 0 0 5.357 15h5.285a1.5 1.5 0 0 0 1.493-1.35l.815-8.15h.3a.75.75 0 0 0 0-1.5H11v-.75A2.25 2.25 0 0 0 8.75 1h-1.5A2.25 2.25 0 0 0 5 3.25Zm2.25-.75a.75.75 0 0 0-.75.75V4h3v-.75a.75.75 0 0 0-.75-.75h-1.5ZM6.05 6a.75.75 0 0 1 .787.713l.275 5.5a.75.75 0 0 1-1.498.075l-.275-5.5A.75.75 0 0 1 6.05 6Zm3.9 0a.75.75 0 0 1 .712.787l-.275 5.5a.75.75 0 0 1-1.498-.075l.275-5.5a.75.75 0 0 1 .786-.711Z","clip-rule":"evenodd"})])}const ie={class:"w-full flex flex-col gap-4 rounded-lg bg-base-200 p-2 lg:p-4"},ne={class:"flex justify-between gap-4 items-center"},ae={key:0,class:"border-4 border-dashed border-primary/20 rounded-xl mt-8 text-center p-10 text-xl text-primary/60 font-bold"},re={key:1},de={key:0,class:"border-4 border-dashed border-primary/20 rounded-xl mt-8 text-center p-10"},ue={class:"mt-8 text-center"},ce={class:"flex flex-col gap-4 mt-10"},pe={class:"flex items-center gap-3"},fe={key:0},me={key:1},ve={class:"text-xl"},_e={class:"flex items-center gap-2"},he=["onClick"],ge={__name:"AdminCoursesListManage",props:{product:{default:{id:0}}},setup(k){const s=new se("alt"),u=E(),a=z(),_=j(),c=B([]),y=k,v=()=>{$.post("admin/product/courses-list",{product_id:a.params.id}).then(f=>{f.ok&&(c.value=f.courses)})},l=()=>{const f=u.resolve({name:"admin_product_course_new",params:{product_id:y.product.id}});window.open(f.href,"_blank")};N(()=>{v(),s.listen("add_course","a",()=>{l()}),s.listen("reload_courses","r",()=>{v()})});const V=f=>!(f.publish==!1||f.publish=="0"),A=f=>{O.fire({title:f.title,text:"آیا از حذف این بخش اطمینان دارید؟",icon:"warning",showCancelButton:!0,confirmButtonText:"حذف کن",cancelButtonText:"لغو"}).then(n=>{n.isConfirmed&&S(f)})},S=f=>{$.post("admin/product/course-remove",{course_id:f.id}).then(()=>{_.showToast("قسمت با موفقیت حذف شد"),v()})};return Z(()=>{s.removeAll()}),(f,n)=>{const t=I("router-link");return i(),r("div",ie,[e("div",ne,[n[2]||(n[2]=e("div",{class:"text-xl font-bold"},"لیست دوره های محصول",-1)),e("div",null,[e("button",{onClick:n[0]||(n[0]=d=>l()),class:"btn btn-primary"},"ایجاد قسمت")])]),k.product.id==0||!k.product.id?(i(),r("div",ae,n[3]||(n[3]=[w(" لطفا ابتدا اطلاعات اولیه محصول را ذخیره کنید و سپس به این قسمت مراجعه نمایید "),e("div",{class:"text-primary text-4xl mt-8"},"😅",-1)]))):(i(),r("div",re,[c.value.length==0?(i(),r("div",de,[n[5]||(n[5]=e("div",{class:"text-xl text-primary/60 font-bold"}," هنوز محتوایی اضافه نشده است ",-1)),e("div",ue,[e("button",{onClick:n[1]||(n[1]=d=>l()),class:"btn btn-xl btn-primary"}," افزودن قسمت جدید "),n[4]||(n[4]=e("div",{dir:"ltr",class:"mt-4"},[e("kbd",{class:"kbd"},"alt"),w(" + "),e("kbd",{class:"kbd"},"A")],-1))])])):b("",!0),e("div",ce,[(i(!0),r(L,null,P(c.value,d=>(i(),r("div",{class:T([{"opacity-70":V(d)==!1},"p-4 rounded-xl bg-base-100 flex justify-between items-center"]),key:d.id},[e("div",pe,[V(d)==!1?(i(),r("div",fe,"⚠️")):(i(),r("div",me,"✳️")),e("div",ve,D(d.title),1)]),e("div",_e,[h(t,{target:"_blank",to:{name:"admin_product_course_edit",params:{product_id:p(a).params.id,course_id:d.id}},class:"cursor-pointer p-1 hover:scale-105 duration-200 hover:bg-primary/40 rounded-xl text-primary bg-primary/20"},{default:C(()=>[h(p(le),{class:"size-8"})]),_:2},1032,["to"]),e("button",{onClick:o=>A(d),class:"cursor-pointer p-1 hover:scale-105 duration-200 hover:bg-primary/20 rounded-xl text-warning"},[h(p(oe),{class:"size-8"})],8,he)])],2))),128))])]))])}}},be={role:"tablist",class:"tabs tabs-box"},ye={key:0,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},xe={class:"w-full flex flex-col gap-4 rounded-lg bg-base-200 p-2 lg:p-4"},ke={class:"fieldset"},we={class:"grid grid-cols-1 lg:grid-cols-2 gap-2 lg:gap-4"},Ce={class:"fieldset"},$e={class:"fieldset"},Ve={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ae={class:"fieldset"},Te={class:"fieldset"},Ue={class:"fieldset"},Me={class:""},Be={class:"rounded-lg bg-base-200 p-2 lg:p-4 flex flex-col gap-4 lg:min-w-sm"},Le={class:"text-center"},Pe={class:"mt-4"},Se=["src"],De={key:1,class:"mx-auto"},Ee={class:"fieldset bg-base-100 border-base-300 rounded-box w-64 border p-4 lg:mt-auto w-full"},ze={class:"label"},je=["checked"],Ie={key:1,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},Ne={key:2,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},Ze={class:"w-full flex flex-col gap-4 rounded-lg bg-base-200 p-2 lg:p-4"},Oe={class:"flex gap-4 items-end"},Re={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 flex-1 gap-4 items-center"},qe={class:"col-span-1 sm:col-span-3 md:col-span-1 fieldset flex items-center"},Fe=["onUpdate:modelValue"],He=["onUpdate:modelValue"],Ge={class:"col-span-1 fieldset"},Ke=["onUpdate:modelValue"],Je={class:"col-span-1 fieldset"},Qe=["onUpdate:modelValue"],We={class:"flex gap-2"},Xe=["onClick"],Ye={class:"flex gap-4 flex-col w-full mt-4 py-4"},et={class:"w-full flex flex-col gap-4 rounded-lg bg-base-200 p-2 lg:p-4"},tt={class:"text-xl font-bold"},ut={__name:"ProductManageView",setup(k){const s=W(),u=j(),a=z(),_=E(),c=async()=>{const n=await $.post("admin/product/info",{id:a.params.id});n.ok&&(l.value=n.product,v.value=n.inventorys,l.value.publish===1||l.value.publish==="1"?l.value.publish=!0:l.value.publish=!1)},y=B(null),v=B([]),l=B({});R(()=>l.value.title,n=>{l.value.link=K(n)});const V=()=>{v.value.push({name:"",price:0,count:1})};V();const A=async()=>{const n=await $.post("admin/product/save",{...l.value,inventorys:v.value});n.ok&&(u.showToast("عملیات با موفقیت انجام شد!","success"),a.name=="admin_product_new"&&(await _.push({name:"admin_product_edit",params:{id:n.product.id}}),c()))},S=n=>{const t=n.target.files[0];$.uploadFile("admin/product/upload-image",t,{},d=>{console.log(d)},d=>{console.log(d),d.ok&&(l.value.image=d.dir)},d=>{})};var f=q.findPluginsByPath("product/manage");return a.name=="admin_product_new"?s.setTitle("ایجاد محصول جدید"):(s.setTitle("ویرایش محصول"),c()),(n,t)=>{const d=I("RouterLink");return i(),r("div",null,[h(Q,{title:p(s).getTitle},{default:C(()=>[e("div",be,[h(d,{to:{hash:""},role:"tab",class:T(["tab",{"tab-active tab-primary":p(a).hash==""}])},{default:C(()=>t[9]||(t[9]=[w(" اطلاعات محصول ")])),_:1,__:[9]},8,["class"]),l.value.content_type=="physical"?(i(),M(d,{key:0,to:{hash:"#inventory"},class:T([{"tab-active ":p(a).hash=="#inventory"},"tab"]),role:"tab"},{default:C(()=>t[10]||(t[10]=[w("موجودی محصول")])),_:1,__:[10]},8,["class"])):b("",!0),l.value.content_type=="media"?(i(),M(d,{key:1,to:{hash:"#courses"},class:T([{"tab-active":p(a).hash=="#courses"},"tab"]),role:"tab"},{default:C(()=>t[11]||(t[11]=[w("دوره های محصول")])),_:1,__:[11]},8,["class"])):b("",!0),(i(!0),r(L,null,P(p(f),(o,U)=>(i(),M(d,{key:U,to:{hash:"#"+o.name},class:T([{"tab-active":p(a).hash=="#"+o.name},"tab"]),role:"tab"},{default:C(()=>[w(D(o.title),1)]),_:2},1032,["to","class"]))),128))])]),_:1},8,["title"]),p(a).hash==""?(i(),r("div",ye,[e("div",xe,[e("fieldset",ke,[t[12]||(t[12]=e("legend",{class:"fieldset-legend"},"عنوان محصول",-1)),m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>l.value.title=o),class:"input input-primary w-full",type:"text",placeholder:"عنوان محصول"},null,512),[[g,l.value.title]])]),e("div",we,[e("fieldset",Ce,[t[13]||(t[13]=e("legend",{class:"fieldset-legend"},"لینک محصول",-1)),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>l.value.link=o),class:"input input-primary w-full",type:"text",placeholder:"لینک محصول"},null,512),[[g,l.value.link]])]),e("fieldset",$e,[t[15]||(t[15]=e("legend",{class:"fieldset-legend"}," نوع محتوای محصول ",-1)),m(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>l.value.content_type=o),class:"select select-primary w-full"},t[14]||(t[14]=[e("option",{value:"physical"},"محتوای فیزیکی",-1),e("option",{value:"media"},"محتوای رسانه/ویدیو/دوره آموزشی",-1)]),512),[[F,l.value.content_type]])])]),l.value.content_type=="media"?(i(),r("div",Ve,[e("fieldset",Ae,[t[16]||(t[16]=e("legend",{class:"fieldset-legend"},"قیمت اصلی",-1)),m(e("input",{dir:"ltr","onUpdate:modelValue":t[3]||(t[3]=o=>l.value.price=o),class:"input input-primary w-full",type:"number",placeholder:""},null,512),[[g,l.value.price]])]),e("fieldset",Te,[t[17]||(t[17]=e("legend",{class:"fieldset-legend"},"قیمت نمایشی (برای تخفیف باید بیشتر از قیمت اصلی باشد)",-1)),m(e("input",{dir:"ltr","onUpdate:modelValue":t[4]||(t[4]=o=>l.value.show_price=o),class:"input input-primary w-full",type:"number",placeholder:""},null,512),[[g,l.value.show_price]])])])):b("",!0),e("div",null,[e("fieldset",Ue,[t[18]||(t[18]=e("legend",{class:"fieldset-legend"},"توضیحات کوتاه",-1)),m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>l.value.small_description=o),class:"input input-primary w-full",type:"text",placeholder:""},null,512),[[g,l.value.small_description]])])]),e("div",Me,[t[19]||(t[19]=e("legend",{class:"fieldset-legend"},"توضیحات",-1)),(i(),M(J,{key:l.value.id,value:l.value.description,onInput:t[6]||(t[6]=o=>l.value.description=o)},null,8,["value"]))])]),e("div",Be,[e("div",Le,[e("input",{onChange:S,ref_key:"upload_main_image",ref:y,accept:".png, .jpg, .webp",type:"file",class:"hidden"},null,544),e("div",Pe,[l.value.image?(i(),r("img",{key:0,class:"max-w-72 w-full h-full mx-auto rounded-lg",src:p($).server+l.value.image,alt:""},null,8,Se)):(i(),r("div",De,[h(p(X),{class:"mx-auto size-32"})]))]),e("button",{class:"btn btn-primary mt-4",onClick:t[7]||(t[7]=o=>y.value.click())}," آپلود عکس محصول ")]),e("fieldset",Ee,[e("label",ze,[m(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=o=>l.value.publish=o),checked:l.value.publish,class:"checkbox checkbox-success"},null,8,je),[[H,l.value.publish]]),t[20]||(t[20]=w(" انتشار محصول "))])]),e("div",{class:"text-center"},[e("button",{onClick:A,class:"btn btn-success"}," ذخیره محصول ")])])])):b("",!0),p(a).hash=="#courses"?(i(),r("div",Ie,[h(ge,{product:l.value},null,8,["product"])])):b("",!0),p(a).hash=="#inventory"?(i(),r("div",Ne,[e("div",Ze,[t[24]||(t[24]=e("div",{class:"text-xl font-bold"},"موجودی محصول",-1)),(i(!0),r(L,null,P(v.value,(o,U)=>(i(),r("div",Oe,[e("div",Re,[e("fieldset",qe,[t[21]||(t[21]=e("legend",{class:"fieldset-legend"},"مدل/رنگ",-1)),m(e("input",{class:"color",style:{width:"40px",height:"40px","border-radius":"30px"},type:"color","onUpdate:modelValue":x=>o.color=x},null,8,Fe),[[g,o.color]]),m(e("input",{"onUpdate:modelValue":x=>o.name=x,class:"input input-primary w-full"},null,8,He),[[g,o.name]])]),e("fieldset",Ge,[t[22]||(t[22]=e("legend",{class:"fieldset-legend"},"قیمت",-1)),m(e("input",{"onUpdate:modelValue":x=>o.price=x,class:"input input-primary w-full"},null,8,Ke),[[g,o.price]])]),e("fieldset",Je,[t[23]||(t[23]=e("legend",{class:"fieldset-legend"},"موجودی",-1)),m(e("input",{"onUpdate:modelValue":x=>o.quantity=x,class:"input input-primary w-full"},null,8,Qe),[[g,o.quantity]])])]),e("div",We,[v.value.length>1?(i(),r("button",{key:0,onClick:x=>v.value.splice(U,1),class:"cursor-pointer p-2 border-error hover:bg-error/20 duration-200 text-error rounded-lg border-1"},[h(p(ee),{class:"size-6"})],8,Xe)):b("",!0),U==v.value.length-1?(i(),r("button",{key:1,onClick:V,class:"cursor-pointer hover:bg-info/20 duration-200 p-2 rounded-lg border-1"},[h(p(te),{class:"size-6"})])):b("",!0)])]))),256)),e("div",{class:"text-center"},[e("button",{onClick:A,class:"btn btn-success"}," ذخیره موجودی محصول ")])])])):b("",!0),(i(!0),r(L,null,P(p(f),o=>m((i(),r("div",Ye,[e("div",et,[e("div",tt,D(o?.title),1),h(Y,{variable:l.value,plugin:o},null,8,["variable","plugin"]),e("div",{class:"text-center mt-8"},[e("button",{onClick:A,class:"btn btn-success"}," ذخیره اطلاعات ")])])],512)),[[G,p(a).hash=="#"+o.name]])),256))])}}};export{ut as default};
