import{G as S,r as M,s as N,h as d,g as a,d as e,k as n,A as f,b as m,u as R,x as A,P as E,y as q,m as _,w as k,e as y,v as j,c as w,B as C,C as G,F as I,l as P,f as H,j as J,q as T,t as z,D as K,E as O}from"./index-WgpEt6N9.js";import{r as F,_ as D,a as Q}from"./PluginFormBuilder-BVMsLnab.js";import{_ as W}from"./TitleBar-DlQArSd_.js";import{u as X}from"./sidebar-HwEejmSs.js";import{r as Y}from"./TrashIcon-B579-Ga4.js";import"./ComInput-Cfhc8fGX.js";const Z={class:"text-center"},ee={class:"mt-4"},se=["src"],te={key:1,class:"mx-auto"},le={__name:"SimpleImageUploader",props:S({uploadUrl:{default:""},parrams:{default:{}}},{modelValue:{},modelModifiers:{}}),emits:S(["changeImage","progress","success","error"],["update:modelValue"]),setup(V,{emit:v}){const b=M(null),i=N(V,"modelValue"),g=v,p=V,x=()=>{const c=b.value.files[0];g("changeImage",c),p.uploadUrl&&p?.uploadUrl?.length&&l(c)},l=c=>{f.uploadFile(p.uploadUrl,c,p.parrams,u=>{g("progress",u)},u=>{g("success",u),u.ok&&(i.value=u.dir)},u=>{g("error",u)})};return(c,u)=>(a(),d("div",Z,[e("input",{onChange:x,ref_key:"upload_main_image",ref:b,accept:".png, .jpg, .webp",type:"file",class:"hidden"},null,544),e("div",ee,[i.value?(a(),d("img",{key:0,class:"max-w-72 w-full h-full mx-auto rounded-lg",src:n(f).server+i.value,alt:""},null,8,se)):(a(),d("div",te,[m(n(F),{class:"mx-auto size-32"})]))]),e("button",{class:"btn btn-primary mt-4",onClick:u[0]||(u[0]=$=>b.value.click())}," آپلود عکس محصول ")]))}},ae={role:"tablist",class:"tabs tabs-box"},oe={key:0,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},ne={class:"w-full flex flex-col gap-4 rounded-lg bg-base-200 p-2 lg:p-4"},ie={class:"fieldset"},de={class:"fieldset"},ue={class:""},re={class:"rounded-lg bg-base-200 p-2 lg:p-4 flex flex-col gap-4 lg:min-w-sm"},ce={class:"text-center"},pe={class:"mt-4"},me=["src"],ge={key:1,class:"mx-auto"},fe={class:"fieldset bg-base-100 border-base-300 rounded-box w-64 border p-4 lg:mt-auto w-full"},ve={class:"label"},be=["checked"],_e={key:1,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},xe={class:"w-full flex flex-col gap-4 rounded-lg bg-base-200 p-2 lg:p-4"},he={class:"mt-8 flex flex-col gap-4 lg:gap-8"},ke={class:"pb-2"},ye=["onClick"],we={class:"flex flex-wrap gap-4 justify-center bg-gray-500/20 p-4 rounded-xl"},Ce={class:"flex gap-4 flex-col w-full mt-4 py-4"},Ve={class:"w-full flex flex-col gap-4 rounded-lg bg-base-200 p-2 lg:p-4"},$e={class:"text-xl font-bold"},Se={__name:"PostManageView",setup(V){const v=X(),b=R(),i=q(),g=H(),p=async()=>{const o=await f.post("admin/post/info",{id:i.params.id});o.ok&&(l.value=o.post)},x=M(null),l=M({contents:[]});A(()=>l.value.title,o=>{l.value.link=O(o)});const c=async()=>{const o=await f.post("admin/post/save",{...l.value});o.ok&&(b.showToast("مطلب ذخیره شد!","success"),i.name=="admin_post_new"&&(await g.push({name:"admin_post_edit",params:{id:o.post.id}}),p()))},u=o=>{const s=o.target.files[0];f.uploadFile("admin/post/upload-image",s,{},r=>{console.log(r)},r=>{console.log(r),r.ok&&(console.log(r.dir),l.value.image=r.dir)},r=>{})},$=o=>{const s=new Date().getTime();l.value.contents.push({name:o,id:s})},L=o=>{l.value.contents.splice(o,1)};var B=E.findPluginsByPath("post/manage");return i.name=="admin_post_new"?v.setTitle("ایجاد مطلب جدید"):(v.setTitle("ویرایش مطلب"),p()),(o,s)=>{const r=J("RouterLink");return a(),d("div",null,[m(W,{title:n(v).getTitle},{default:k(()=>[e("div",ae,[m(r,{to:{hash:""},role:"tab",class:T(["tab",{"tab-active tab-primary":n(i).hash==""}])},{default:k(()=>s[7]||(s[7]=[C(" اطلاعات مطلب ")])),_:1,__:[7]},8,["class"]),m(r,{to:{hash:"#contents"},role:"tab",class:T(["tab",{"tab-active tab-primary":n(i).hash=="#contents"}])},{default:k(()=>s[8]||(s[8]=[C(" محتوا ")])),_:1,__:[8]},8,["class"]),(a(!0),d(I,null,P(n(B),(t,U)=>(a(),w(r,{key:U,to:{hash:"#"+t.name},class:T([{"tab-active":n(i).hash=="#"+t.name},"tab"]),role:"tab"},{default:k(()=>[C(z(t.title),1)]),_:2},1032,["to","class"]))),128))])]),_:1},8,["title"]),n(i).hash==""?(a(),d("div",oe,[e("div",ne,[e("fieldset",ie,[s[9]||(s[9]=e("legend",{class:"fieldset-legend"},"عنوان",-1)),y(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>l.value.title=t),class:"input input-primary w-full",type:"text",placeholder:"عنوان "},null,512),[[j,l.value.title]])]),e("fieldset",de,[s[10]||(s[10]=e("legend",{class:"fieldset-legend"},"لینک",-1)),y(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>l.value.link=t),class:"input input-primary w-full",type:"text",placeholder:"لینک "},null,512),[[j,l.value.link]])]),e("div",ue,[s[11]||(s[11]=e("legend",{class:"fieldset-legend"},"متن مطلب",-1)),(a(),w(D,{key:l.value.id,value:l.value.description,onInput:s[2]||(s[2]=t=>l.value.description=t)},null,8,["value"]))])]),e("div",re,[e("div",ce,[e("input",{onChange:u,ref_key:"upload_main_image",ref:x,accept:".png, .jpg, .webp",type:"file",class:"hidden"},null,544),e("div",pe,[l.value.image?(a(),d("img",{key:0,class:"max-w-72 w-full h-full mx-auto rounded-lg",src:n(f).server+l.value.image,alt:""},null,8,me)):(a(),d("div",ge,[m(n(F),{class:"mx-auto size-32"})]))]),e("button",{class:"btn btn-primary mt-4",onClick:s[3]||(s[3]=t=>x.value.click())}," آپلود عکس مطلب ")]),e("fieldset",fe,[e("label",ve,[y(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>l.value.publish=t),type:"checkbox",checked:l.value.publish,class:"checkbox checkbox-success"},null,8,be),[[G,l.value.publish]]),s[12]||(s[12]=C(" انتشار مطلب "))])]),e("div",{class:"text-center"},[e("button",{onClick:c,class:"btn btn-success"}," ذخیره مطلب ")])])])):_("",!0),n(i).hash=="#contents"?(a(),d("div",_e,[e("div",xe,[s[13]||(s[13]=e("div",{class:"text-xl font-bold"},"محتوای مطلب",-1)),e("div",he,[l.value?.contents?(a(!0),d(I,{key:0},P(l.value.contents,(t,U)=>(a(),d("div",{key:t.id,class:"bg-gray-700/30 p-2"},[e("div",ke,[e("button",{onClick:h=>L(U),class:"btn btn-ghost btn-sm"},[m(n(Y),{class:"size-6 text-error"})],8,ye)]),t?.name=="text"?(a(),w(D,{onInput:h=>t.text=h,value:t.text,key:t.id,"com-id":t.id},null,8,["onInput","value","com-id"])):_("",!0),t?.name=="image"?(a(),w(le,{"upload-url":"admin/post/upload-image",modelValue:t.url,"onUpdate:modelValue":h=>t.url=h,key:t.id,"com-id":t.id},null,8,["modelValue","onUpdate:modelValue","com-id"])):_("",!0)]))),128)):_("",!0)]),e("div",we,[e("button",{onClick:s[5]||(s[5]=t=>$("text")),class:"btn btn-outline"}," افزودن متن "),e("button",{onClick:s[6]||(s[6]=t=>$("image")),class:"btn btn-outline"}," افزودن عکس ")]),e("div",{class:"text-center mt-8"},[e("button",{onClick:c,class:"btn btn-success"}," ذخیره محتوای مطلب ")])])])):_("",!0),(a(!0),d(I,null,P(n(B),t=>y((a(),d("div",Ce,[e("div",Ve,[e("div",$e,z(t?.title),1),m(Q,{variable:l.value,plugin:t},null,8,["variable","plugin"]),e("div",{class:"text-center mt-8"},[e("button",{onClick:c,class:"btn btn-success"}," ذخیره اطلاعات ")])])],512)),[[K,n(i).hash=="#"+t.name]])),256))])}}};export{Se as default};
