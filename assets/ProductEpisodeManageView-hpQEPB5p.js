const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TipTop-6r9GHZRD.js","assets/index-CgnrPS0N.js","assets/index-DRwB4UB0.css","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/TipTop-CCLCb3RD.css"])))=>i.map(i=>d[i]);
import{r as y,B as z,h as d,g as r,d as e,m as v,z as S,t as f,E as D,q as m,F as E,l as j,A as h,S as ee,u as te,x as se,o as le,b as V,w as I,k as x,e as B,v as L,c as N,G as oe,D as ne,f as ae,_ as ie,j as re}from"./index-CgnrPS0N.js";import{_ as de}from"./TitleBar-BaWfcQ70.js";import{u as ue}from"./sidebar-BrvxwCby.js";import{_ as K,b as pe}from"./MetaTags-BE5Lizs6.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"w-full max-w-2xl mx-auto"},ce={class:"flex flex-col items-center justify-center space-y-3"},me={class:"text-sm text-gray-500 mt-1"},ge={key:0,class:"text-sm text-blue-500 mt-1"},fe={key:0,class:"mt-6 space-y-3",dir:"ltr"},be={class:"flex items-center justify-between"},_e={class:"flex items-center space-x-3 flex-1"},xe={class:"flex-1"},ye={class:"font-medium text-gray-800 truncate max-w-xs"},we={class:"text-sm text-gray-500 flex gap-4"},ke={key:0},he={class:"flex-1"},$e=["value"],Ce={class:"flex items-center space-x-2"},Ve={key:0,class:"w-8 h-8"},Fe={key:1,class:"w-8 h-8"},Ue={key:2,class:"w-8 h-8"},Be={key:0,class:"mt-2 text-red-500 text-sm"},Se={key:1,class:"mt-4 flex gap-2"},Te={key:2,class:"mt-4 p-4 bg-blue-50 rounded-lg"},Me={class:"flex items-center justify-between"},De={class:"text-sm text-blue-600"},Ie={key:3,class:"mt-8",dir:"ltr"},Le={class:"space-y-2"},ze={class:"flex items-center space-x-3"},Ae={class:"font-medium text-gray-700 truncate"},Pe={class:"flex gap-4 justify-end"},Ee=["onClick"],je=["onClick"],Ne=["onClick"],qe={class:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-4"},Re={class:"flex items-center space-x-3"},Oe={class:"font-medium text-sm text-gray-700 truncate"},He=["onClick"],Ge={__name:"UploadFiles",props:{uploadLink:{type:String,required:!0},episodeId:{type:[String,Number],required:!0},episode:{required:!0},fetchFilesUrl:{type:String,required:!0}},emits:["setVideo","setVideoPoster"],setup(T,{emit:q}){const _=T,M=y(null),u=y(!1),i=y([]),s=y([]),b=y(!1),w=y(-1),k=y(!1),$=z(()=>i.value.filter(n=>n.status==="pending").length),A=z(()=>i.value.filter(n=>n.status==="success").length),P=z(()=>i.value.filter(n=>n.status==="error").length),C=async()=>{try{const n=await h.post(_.fetchFilesUrl,{episode_id:_.episodeId});n.ok&&Array.isArray(n.files)?s.value=n.files.map(o=>({name:o.name,id:o.name})):s.value=[]}catch(n){console.error("Failed to fetch existing files:",n),s.value=[]}};C();const g=()=>{M.value.click()},t=n=>{n.preventDefault(),u.value=!0},F=n=>{n.preventDefault(),u.value=!1;const o=Array.from(n.dataTransfer.files);R(o)},a=n=>{const o=Array.from(n.target.files);R(o),n.target.value=""},R=n=>{const o=n.map(l=>({id:Date.now()+Math.random(),name:l.name,size:l.size,file:l,progress:0,status:"pending",error:null}));i.value.push(...o)},Q=async()=>{if(b.value)return;b.value=!0,k.value=!1,w.value=-1;const n=i.value.filter(o=>o.status==="pending");for(let o=0;o<n.length&&!k.value;o++){w.value=i.value.findIndex(l=>l.id===n[o].id);try{await W(n[o])}catch(l){console.error("Upload stopped due to error:",l);break}await new Promise(l=>setTimeout(l,100))}b.value=!1,w.value=-1,k.value||await C()},J=()=>{k.value=!0,b.value=!1},W=n=>new Promise((o,l)=>{const p=i.value.findIndex(c=>c.id===n.id);if(p===-1){l(new Error("File not found"));return}i.value[p]={...i.value[p],status:"uploading",progress:0},h.uploadFile(_.uploadLink,n.file,{episode_id:_.episodeId},c=>{p!==-1&&(i.value[p]={...i.value[p],progress:parseInt(c)})},c=>{if(console.log("resp",c),c.ok&&c.status)i.value[p]={...i.value[p],status:"success",progress:100},o(c);else{const U=c.error||"Upload failed";i.value[p]={...i.value[p],status:"error",error:U},l(new Error(U))}},c=>{i.value[p]={...i.value[p],status:"error",error:"Network error occurred"},l(new Error("Network error occurred"))})}),X=()=>{i.value=i.value.filter(n=>n.status==="pending")},Y=()=>{i.value=[]},O=(n,o)=>{const l=n.toLowerCase().split(".").pop();return o.indexOf(l)>-1},Z=(n,o=2)=>{if(n===0)return"0 Bytes";const l=1024,p=o<0?0:o,c=["Bytes","KB","MB","GB"],U=Math.floor(Math.log(n)/Math.log(l));return parseFloat((n/Math.pow(l,U)).toFixed(p))+" "+c[U]},H=n=>{const o=["mp4","png","jpg","mpd","webp"],l=n.toLowerCase().split(".").pop();return o.indexOf(l)>-1},G=async n=>{(await ee.fire({title:"آیا مطمئن هستید؟",text:`آیا از حذف فایل "${n.name}" اطمینان دارید؟`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"بله، حذف شود",cancelButtonText:"لغو"})).isConfirmed&&(console.log(_.episode),(await h.post("admin/product/delete-episode-file",{file_name:n.name,episode_id:_.episode.id})).ok&&C())};return(n,o)=>(r(),d("div",ve,[e("div",{class:m(["relative border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all duration-300",{"border-blue-500 bg-blue-50":u.value,"border-gray-300 hover:border-gray-400 hover:bg-gray-50":!u.value}]),onDragover:D(t,["prevent"]),onDragenter:o[0]||(o[0]=D(l=>u.value=!0,["prevent"])),onDragleave:o[1]||(o[1]=D(l=>u.value=!1,["prevent"])),onDrop:D(F,["prevent"]),onClick:g},[e("input",{ref_key:"fileInput",ref:M,type:"file",multiple:"",class:"hidden",onChange:a},null,544),e("div",ce,[o[3]||(o[3]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),e("div",null,[o[2]||(o[2]=e("p",{class:"font-medium text-gray-700"},[e("span",{class:"text-blue-600 font-semibold"},"Click to upload"),S(" or drag and drop ")],-1)),e("p",me," Supports multiple files ("+f(i.value.length)+" selected) ",1),b.value?(r(),d("p",ge," Uploading... "+f(w.value+1)+"/"+f(i.value.length),1)):v("",!0)])])],34),i.value.length>0?(r(),d("div",fe,[(r(!0),d(E,null,j(i.value,(l,p)=>(r(),d("div",{key:l.id,class:m(["border rounded-lg p-4 bg-white shadow-sm",{"border-blue-200 bg-blue-50":l.status==="uploading","border-green-200 bg-green-50":l.status==="success","border-red-200 bg-red-50":l.status==="error"}])},[e("div",be,[e("div",_e,[o[4]||(o[4]=e("div",{class:"bg-gray-100 p-2 rounded-lg"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e("div",xe,[e("p",ye,f(l.name),1),e("div",we,[e("div",null,[e("span",null,f(Z(l.size)),1)]),l.progress>0?(r(),d("div",ke,[e("span",null,f(l.progress)+"%",1)])):v("",!0),e("div",he,[e("progress",{class:"progress progress-primary w-full",value:l.progress,max:"100"},null,8,$e)])])])]),e("div",Ce,[l.status==="uploading"?(r(),d("div",Ve,o[5]||(o[5]=[e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"},null,-1)]))):l.status==="error"?(r(),d("div",Fe,o[6]||(o[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)]))):l.status==="success"?(r(),d("div",Ue,o[7]||(o[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)]))):v("",!0)])]),l.status==="error"?(r(),d("div",Be,f(l.error),1)):v("",!0)],2))),128))])):v("",!0),i.value.length>0&&!b.value?(r(),d("div",Se,[e("button",{onClick:Q,class:"btn btn-primary"}," Start Upload ("+f($.value)+" files) ",1),e("button",{onClick:X,class:"btn btn-outline"}," Clear Completed "),e("button",{onClick:Y,class:"btn btn-outline"}," Clear All ")])):v("",!0),b.value?(r(),d("div",Te,[e("div",Me,[e("div",null,[o[8]||(o[8]=e("p",{class:"font-medium text-blue-700"},"Uploading in progress...",-1)),e("p",De,f(w.value+1)+" of "+f(i.value.length)+" files ("+f(A.value)+" successful, "+f(P.value)+" failed) ",1)]),e("button",{onClick:J,class:"btn btn-sm btn-outline text-red-600"}," Stop Upload ")])])):v("",!0),s.value.length>0?(r(),d("div",Ie,[o[10]||(o[10]=e("h3",{class:"text-lg font-medium text-gray-200 mb-3"},"Uploaded Files",-1)),e("div",Le,[(r(!0),d(E,null,j(s.value.filter(l=>H(l.name)===!0),(l,p)=>(r(),d("div",{key:l.id||l.name,class:"p-3 bg-gray-50 rounded-lg border flex flex-col gap-4"},[e("div",ze,[o[9]||(o[9]=e("div",{class:"bg-gray-200 p-2 rounded"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e("span",Ae,f(l.name),1)]),e("div",Pe,[O(l.name,["mpd","mp4"])?(r(),d("button",{key:0,onClick:c=>n.$emit("setVideo",l),class:m([{"btn-primary":l.name==T.episode.video_target},"btn btn-sm"])}," Set Video ",10,Ee)):v("",!0),O(l.name,["png","jpg","webp"])?(r(),d("button",{key:1,onClick:c=>n.$emit("setVideoPoster",l),class:m([{"btn-primary":l.name==T.episode.video_poster},"btn btn-sm"])}," Set Video Poster ",10,je)):v("",!0),e("button",{onClick:c=>G(l),class:"btn btn-sm btn-warning btn-outline"},"delete",8,Ne)])]))),128)),e("div",qe,[(r(!0),d(E,null,j(s.value.filter(l=>H(l.name)===!1),(l,p)=>(r(),d("div",{key:l.id||l.name,class:"p-3 bg-gray-50 rounded-lg border opacity-50"},[e("div",Re,[e("span",Oe,f(l.name),1)]),e("div",null,[e("button",{onClick:c=>G(l),class:"btn btn-sm btn-warning btn-outline"},"delete",8,He)])]))),128))])])])):v("",!0)]))}},Ke={class:"mr-auto flex gap-4 items-center"},Qe={role:"tablist",class:"tabs tabs-box"},Je=["src"],We={key:0,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},Xe={class:"w-full flex flex-col gap-4 rounded-lg bg-base-200 p-2 lg:p-4"},Ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ze={class:"fieldset"},et={class:"border border-primary p-4 rounded-xl bg-base-100"},tt={class:"flex gap-4 justify-start mt-4"},st={key:0,class:"mt-6"},lt={class:"fieldset"},ot={class:"border border-primary p-4 rounded-xl bg-base-100"},nt={class:"flex gap-4 justify-start mt-4"},at={key:0,class:"p-2 rounded-xl mt-4 bg-green-500/10 text-green-700",dir:"auto"},it={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},rt={class:"fieldset"},dt={class:"fieldset"},ut={class:"grid grid-cols-1 md:grid-cols-3"},pt={class:"fieldset bg-base-100 border-base-300 rounded-box w-64 border p-4 lg:mt-auto w-full"},vt={class:"label"},ct=["checked"],mt={class:"text-center"},gt={key:1,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},ft={key:2,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},kt={__name:"ProductEpisodeManageView",setup(T){const q=oe(()=>ie(()=>import("./TipTop-6r9GHZRD.js"),__vite__mapDeps([0,1,2,3,4]))),_=ue(),M=te(),u=se(),i=ae(),s=y({}),b=y({title:""}),w=async()=>{const g=await h.post("admin/product/info",{id:u.params.product_id});g.ok&&(b.value=g.product,u.name!="admin_product_episode_new"&&k())},k=async()=>{const g=await h.post("admin/product/episode-info",{episode_id:u.params.episode_id});g.ok&&(s.value=g.episode)},$=async()=>{const g=await h.post("admin/product/episode-save",{...s.value,product_id:u.params.product_id});g.ok&&(M.showToast("عملیات با موفقیت انجام شد!","success"),u.name=="admin_product_episode_new"&&(await i.push({name:"admin_product_episode_edit",params:{product_id:u.params.product_id,episode_id:g.episode_id}}),k()))};u.name=="admin_product_episode_new"?_.setTitle("ایجاد قسمت جدید"):_.setTitle("ویرایش قسمت");const A=g=>{s.value.video_target=g.name,$()},P=g=>{s.value.video_poster=g.name,$()};le(()=>{w()});const C=z(()=>`\`\`\` 
<h1>${s.value.title}</h1> <br> ${s.value.description} 
 \`\`\` 
---
  
`);return(g,t)=>{const F=re("RouterLink");return r(),d("div",null,[V(de,{title:x(_).getTitle+" - ("+b.value.title+")"},{default:I(()=>[e("div",Ke,[e("div",Qe,[V(F,{to:{hash:""},role:"tab",class:m(["tab",{"tab-active tab-primary":x(u).hash==""}])},{default:I(()=>t[20]||(t[20]=[S(" اطلاعات کلی ")])),_:1,__:[20]},8,["class"]),V(F,{to:{hash:"#meta"},class:m([{"tab-active":x(u).hash=="#meta"},"tab"]),role:"tab"},{default:I(()=>t[21]||(t[21]=[S(" متا تگ‌ها ")])),_:1,__:[21]},8,["class"]),V(F,{to:{hash:"#videos"},class:m([{"tab-active":x(u).hash=="#videos"},"tab"]),role:"tab"},{default:I(()=>t[22]||(t[22]=[S(" فایل ها ")])),_:1,__:[22]},8,["class"])]),e("img",{src:x(h).server+b.value.image,class:"size-10 rounded-xl",alt:""},null,8,Je)])]),_:1},8,["title"]),x(u).hash==""?(r(),d("div",We,[e("div",Xe,[e("div",Ye,[e("fieldset",Ze,[t[23]||(t[23]=e("legend",{class:"fieldset-legend"},"عنوان قسمت دوره",-1)),B(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.value.title=a),class:"input input-primary w-full",type:"text",placeholder:"عنوان محصول"},null,512),[[L,s.value.title]])]),V(K,{title:"لینک قسمت","site-domain":"/","ai-use-type":"link_generator","ai-input":s.value.title,modelValue:s.value.link,"onUpdate:modelValue":t[1]||(t[1]=a=>s.value.link=a)},null,8,["ai-input","modelValue"])]),e("div",{class:m({"opacity-70":s.value.display_status==="introduction"})},[V(K,{maxlength:140,title:"توضیح کوتاه","ai-use-type":"small_description","ai-input":C.value,modelValue:s.value.small_description,"onUpdate:modelValue":t[2]||(t[2]=a=>s.value.small_description=a)},null,8,["ai-input","modelValue"])],2),e("div",{class:m({"opacity-70":s.value.display_status==="introduction"})},[t[24]||(t[24]=e("legend",{class:"fieldset-legend"},"توضیحات",-1)),(r(),N(x(q),{key:s.value.id,default:s.value.description,modelValue:s.value.description,"onUpdate:modelValue":t[3]||(t[3]=a=>s.value.description=a)},null,8,["default","modelValue"]))],2),e("div",et,[t[26]||(t[26]=e("div",null," نوع ارائه این قسمت : ",-1)),e("div",tt,[e("button",{class:m([`${s.value.display_status==="introduction"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[4]||(t[4]=a=>s.value.display_status="introduction")}," معرفی دوره ",2),e("button",{class:m([`${s.value.display_status==="free"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[5]||(t[5]=a=>s.value.display_status="free")},"رایگان",2),e("button",{class:m([`${s.value.display_status==="free_with_login"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[6]||(t[6]=a=>s.value.display_status="free_with_login")}," رایگان با لاگین ",2),e("button",{class:m([`${s.value.display_status==="vip_preview"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[7]||(t[7]=a=>s.value.display_status="vip_preview")}," خرید+پیش‌نمایش ",2),e("button",{class:m([`${s.value.display_status==="vip"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[8]||(t[8]=a=>s.value.display_status="vip")}," خرید ",2)]),s.value.display_status=="vip_preview"?(r(),d("div",st,[e("fieldset",lt,[t[25]||(t[25]=e("legend",{class:"fieldset-legend"},"مدت زمان پیش نمایش رایگان (به ثانیه)",-1)),B(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>s.value.free_demo_time=a),class:"input input-primary w-full",type:"number",placeholder:""},null,512),[[L,s.value.free_demo_time]])])])):v("",!0)]),e("div",ot,[t[27]||(t[27]=e("div",null," نوع ویدیو : ",-1)),e("div",nt,[e("button",{class:m([`${s.value.video_type==="dash"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[10]||(t[10]=a=>s.value.video_type="dash")},"DASH",2),e("button",{class:m([`${s.value.video_type==="mp4"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[11]||(t[11]=a=>s.value.video_type="mp4")},"mp4",2)]),s.value.video_target?(r(),d("div",at,f(s.value.video_target),1)):v("",!0)]),e("div",it,[e("div",null,[e("fieldset",rt,[t[28]||(t[28]=e("legend",{class:"fieldset-legend"},"مدت زمان ویدیو به ثانیه",-1)),B(e("input",{"onUpdate:modelValue":t[12]||(t[12]=a=>s.value.duration=a),class:"input input-primary w-full",type:"number",placeholder:""},null,512),[[L,s.value.duration]])])]),e("div",null,[e("fieldset",dt,[t[29]||(t[29]=e("legend",{class:"fieldset-legend"},"جایگاه (برای مرتب سازی) (به صورت عدد 0 تا 100)",-1)),B(e("input",{"onUpdate:modelValue":t[13]||(t[13]=a=>s.value.sort_index=a),class:"input input-primary w-full",type:"text",placeholder:""},null,512),[[L,s.value.sort_index]])])])]),e("div",ut,[e("fieldset",pt,[e("label",vt,[B(e("input",{type:"checkbox","onUpdate:modelValue":t[14]||(t[14]=a=>s.value.publish=a),checked:s.value.publish,class:"checkbox checkbox-success"},null,8,ct),[[ne,s.value.publish]]),t[30]||(t[30]=S(" انتشار "))])])]),e("div",mt,[e("button",{onClick:t[15]||(t[15]=a=>$()),class:"btn btn-success"}," ذخیره قسمت ")])])])):v("",!0),x(u).hash=="#meta"?(r(),d("div",gt,[s.value.id?(r(),N(pe,{key:0,modelValue:s.value,"onUpdate:modelValue":t[16]||(t[16]=a=>s.value=a),"ai-input":C.value,onSave:t[17]||(t[17]=a=>$())},null,8,["modelValue","ai-input"])):v("",!0)])):v("",!0),x(u).hash=="#videos"?(r(),d("div",ft,[s.value.id?(r(),N(Ge,{key:0,onSetVideoPoster:t[18]||(t[18]=a=>P(a)),onSetVideo:t[19]||(t[19]=a=>A(a)),"fetch-files-url":"get-episode-files",episode:s.value,"episode-id":s.value.id,"upload-link":"admin/product/upload-episode-video"},null,8,["episode","episode-id"])):v("",!0)])):v("",!0)])}}};export{kt as default};
