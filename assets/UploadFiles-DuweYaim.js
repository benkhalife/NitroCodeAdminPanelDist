import{h as o,g as l,d as t,r as m,B as F,m as u,z as J,t as d,H as k,q as x,F as B,l as U,b as z,k as I,A as C,S as R}from"./index-DTU4WR6h.js";import{r as W}from"./PencilIcon-CS6JyIl8.js";function X(v,L){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z","clip-rule":"evenodd"})])}const Y={class:"w-full max-w-2xl mx-auto"},ee={class:"flex flex-col items-center justify-center space-y-3"},te={class:"text-sm text-gray-500 mt-1"},se={key:0,class:"text-sm text-blue-500 mt-1"},re={key:0,class:"mt-6 space-y-3",dir:"ltr"},ne={class:"flex items-center justify-between"},oe={class:"flex items-center space-x-3 flex-1"},le={class:"flex-1"},ae={class:"font-medium text-gray-800 truncate max-w-xs"},ie={class:"text-sm text-gray-500 flex gap-4"},de={key:0},ue={class:"flex-1"},ce=["value"],pe={class:"flex items-center space-x-2"},me={key:0,class:"w-8 h-8"},ve={key:1,class:"w-8 h-8"},ge={key:2,class:"w-8 h-8"},he={key:0,class:"mt-2 text-red-500 text-sm"},xe={key:1,class:"mt-4 flex gap-2"},be={key:2,class:"mt-4 p-4 bg-blue-50 rounded-lg"},we={class:"flex items-center justify-between"},fe={class:"text-sm text-blue-600"},ye={key:3,class:"mt-8",dir:"ltr"},_e={class:"space-y-2"},ke={class:"flex items-center space-x-3"},Ce={key:0,class:"flex items-center gap-4"},Fe={class:"font-medium text-gray-700 truncate"},Be=["onClick"],Ue={key:1,class:"flex items-center gap-2"},Se=["value","onInput"],Ve=["onClick"],$e={class:"flex gap-4 justify-end"},Me=["onClick"],ze=["onClick"],Ie=["onClick"],Le=["onClick"],Ae=["onClick"],De={class:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-4"},Pe={class:"flex items-center space-x-3"},je={class:"font-medium text-sm text-gray-700 truncate"},Te=["onClick"],Ne={__name:"UploadFiles",props:{uploadLink:{type:String,required:!0},episode:{required:!0},fetchFilesUrl:{type:String,required:!0},deleteFileUrl:{type:String,required:!0,default:"admin/product/delete-episode-file"},renameFileUrl:{default:""}},emits:["setVideo","setVideoPoster"],setup(v,{emit:L}){const c=v,S=m(null),g=m(!1),n=m([]),h=m([]),p=m(!1),b=m(-1),f=m(!1),A=F(()=>n.value.filter(s=>s.status==="pending").length),D=F(()=>n.value.filter(s=>s.status==="success").length),P=F(()=>n.value.filter(s=>s.status==="error").length),y=async()=>{try{const s=await C.post(c.fetchFilesUrl,{id:c.episode.id});s.ok&&Array.isArray(s.files)?h.value=s.files.map(r=>({name:r.name,id:r.name})):h.value=[]}catch(s){console.error("Failed to fetch existing files:",s),h.value=[]}};y();const j=async s=>{s.edit_name=!1,s.new_name&&(await C.post(c.renameFileUrl,{...s,...c.episode}),y())},T=()=>{S.value.click()},q=s=>{s.preventDefault(),g.value=!0},E=s=>{s.preventDefault(),g.value=!1;const r=Array.from(s.dataTransfer.files);V(r)},N=s=>{const r=Array.from(s.target.files);V(r),s.target.value=""},V=s=>{const r=s.map(e=>({id:Date.now()+Math.random(),name:e.name,size:e.size,file:e,progress:0,status:"pending",error:null}));n.value.push(...r)},H=async()=>{if(p.value)return;p.value=!0,f.value=!1,b.value=-1;const s=n.value.filter(r=>r.status==="pending");for(let r=0;r<s.length&&!f.value;r++){b.value=n.value.findIndex(e=>e.id===s[r].id);try{await Z(s[r])}catch(e){console.error("Upload stopped due to error:",e);break}await new Promise(e=>setTimeout(e,100))}p.value=!1,b.value=-1,f.value||await y()},O=()=>{f.value=!0,p.value=!1},Z=s=>new Promise((r,e)=>{const i=n.value.findIndex(a=>a.id===s.id);if(i===-1){e(new Error("File not found"));return}n.value[i]={...n.value[i],status:"uploading",progress:0},C.uploadFile(c.uploadLink,s.file,{id:c.episode.id},a=>{i!==-1&&(n.value[i]={...n.value[i],progress:parseInt(a)})},a=>{if(console.log("resp",a),a.ok&&a.status)n.value[i]={...n.value[i],status:"success",progress:100},r(a);else{const w=a.error||"Upload failed";n.value[i]={...n.value[i],status:"error",error:w},e(new Error(w))}},a=>{n.value[i]={...n.value[i],status:"error",error:"Network error occurred"},e(new Error("Network error occurred"))})}),G=()=>{n.value=n.value.filter(s=>s.status==="pending")},K=()=>{n.value=[]},_=(s,r)=>{const e=s.toLowerCase().split(".").pop();return r.indexOf(e)>-1},Q=(s,r=2)=>{if(s===0)return"0 Bytes";const e=1024,i=r<0?0:r,a=["Bytes","KB","MB","GB"],w=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,w)).toFixed(i))+" "+a[w]},$=s=>{const r=["mp4","mp3","m4a","png","jpg","mpd","webp"],e=s.toLowerCase().split(".").pop();return r.indexOf(e)>-1},M=async s=>{(await R.fire({title:"آیا مطمئن هستید؟",text:`آیا از حذف فایل "${s.name}" اطمینان دارید؟`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"بله، حذف شود",cancelButtonText:"لغو"})).isConfirmed&&(console.log(c.episode),(await C.post(c.deleteFileUrl,{file_name:s.name,id:c.episode.id})).ok&&y())};return(s,r)=>(l(),o("div",Y,[t("div",{class:x(["relative border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all duration-300",{"border-blue-500 bg-blue-50":g.value,"border-gray-300 hover:border-gray-400 hover:bg-gray-50":!g.value}]),onDragover:k(q,["prevent"]),onDragenter:r[0]||(r[0]=k(e=>g.value=!0,["prevent"])),onDragleave:r[1]||(r[1]=k(e=>g.value=!1,["prevent"])),onDrop:k(E,["prevent"]),onClick:T},[t("input",{ref_key:"fileInput",ref:S,type:"file",multiple:"",class:"hidden",onChange:N},null,544),t("div",ee,[r[3]||(r[3]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),t("div",null,[r[2]||(r[2]=t("p",{class:"font-medium text-gray-700"},[t("span",{class:"text-blue-600 font-semibold"},"Click to upload"),J(" or drag and drop ")],-1)),t("p",te," Supports multiple files ("+d(n.value.length)+" selected) ",1),p.value?(l(),o("p",se," Uploading... "+d(b.value+1)+"/"+d(n.value.length),1)):u("",!0)])])],34),n.value.length>0?(l(),o("div",re,[(l(!0),o(B,null,U(n.value,(e,i)=>(l(),o("div",{key:e.id,class:x(["border rounded-lg p-4 bg-white shadow-sm",{"border-blue-200 bg-blue-50":e.status==="uploading","border-green-200 bg-green-50":e.status==="success","border-red-200 bg-red-50":e.status==="error"}])},[t("div",ne,[t("div",oe,[r[4]||(r[4]=t("div",{class:"bg-gray-100 p-2 rounded-lg"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),t("div",le,[t("p",ae,d(e.name),1),t("div",ie,[t("div",null,[t("span",null,d(Q(e.size)),1)]),e.progress>0?(l(),o("div",de,[t("span",null,d(e.progress)+"%",1)])):u("",!0),t("div",ue,[t("progress",{class:"progress progress-primary w-full",value:e.progress,max:"100"},null,8,ce)])])])]),t("div",pe,[e.status==="uploading"?(l(),o("div",me,r[5]||(r[5]=[t("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"},null,-1)]))):e.status==="error"?(l(),o("div",ve,r[6]||(r[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)]))):e.status==="success"?(l(),o("div",ge,r[7]||(r[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)]))):u("",!0)])]),e.status==="error"?(l(),o("div",he,d(e.error),1)):u("",!0)],2))),128))])):u("",!0),n.value.length>0&&!p.value?(l(),o("div",xe,[t("button",{onClick:H,class:"btn btn-primary"}," Start Upload ("+d(A.value)+" files) ",1),t("button",{onClick:G,class:"btn btn-outline"}," Clear Completed "),t("button",{onClick:K,class:"btn btn-outline"}," Clear All ")])):u("",!0),p.value?(l(),o("div",be,[t("div",we,[t("div",null,[r[8]||(r[8]=t("p",{class:"font-medium text-blue-700"},"Uploading in progress...",-1)),t("p",fe,d(b.value+1)+" of "+d(n.value.length)+" files ("+d(D.value)+" successful, "+d(P.value)+" failed) ",1)]),t("button",{onClick:O,class:"btn btn-sm btn-outline text-red-600"}," Stop Upload ")])])):u("",!0),h.value.length>0?(l(),o("div",ye,[r[10]||(r[10]=t("h3",{class:"text-lg font-medium text-gray-200 mb-3"},"Uploaded Files",-1)),t("div",_e,[(l(!0),o(B,null,U(h.value.filter(e=>$(e.name)===!0),(e,i)=>(l(),o("div",{key:e.id||e.name,class:"p-3 bg-gray-50 rounded-lg border flex flex-col gap-4"},[t("div",ke,[r[9]||(r[9]=t("div",{class:"bg-gray-200 p-2 rounded"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e.edit_name?(l(),o("div",Ue,[t("input",{class:"input",value:e.name,onInput:a=>e.new_name=a.target.value,type:"text"},null,40,Se),t("button",{onClick:a=>j(e),class:"btn btn-circle btn-sm"},[z(I(X),{class:"size-10"})],8,Ve)])):(l(),o("div",Ce,[t("span",Fe,d(e.name),1),c.renameFileUrl.length?(l(),o("div",{key:0,onClick:a=>e.edit_name=!e.edit_name,"data-tip":"Edit name",class:"tooltip hover:bg-primary/30 text-primary/50 hover:text-primary p-1 rounded-lg cursor-pointer duration-200"},[z(I(W),{class:"size-4"})],8,Be)):u("",!0)]))]),t("div",$e,[_(e.name,["mpd","mp4"])?(l(),o("button",{key:0,onClick:a=>s.$emit("setVideo",e),class:x([{"btn-primary":e.name==v.episode.video_target},"btn btn-sm"])}," Set Video ",10,Me)):u("",!0),_(e.name,["mpd","mp4"])?(l(),o("button",{key:1,onClick:a=>s.$emit("setVideoPreview",e),class:x([{"btn-primary":e.name==v.episode.video_preview_target},"btn btn-sm"])}," Set Video Preview ",10,ze)):u("",!0),_(e.name,["png","jpg","webp"])?(l(),o("button",{key:2,onClick:a=>s.$emit("setVideoPoster",e),class:x([{"btn-primary":e.name==v.episode.video_poster},"btn btn-sm"])}," Set Video Poster ",10,Ie)):u("",!0),_(e.name,["mp3","m4a"])?(l(),o("button",{key:3,onClick:a=>s.$emit("setAudio",e),class:x([{"btn-primary":e.name==v.episode.audio},"btn btn-sm"])}," Set Post Audio ",10,Le)):u("",!0),t("button",{onClick:a=>M(e),class:"btn btn-sm btn-warning btn-outline"},"delete",8,Ae)])]))),128)),t("div",De,[(l(!0),o(B,null,U(h.value.filter(e=>$(e.name)===!1),(e,i)=>(l(),o("div",{key:e.id||e.name,class:"p-3 bg-gray-50 rounded-lg border opacity-50"},[t("div",Pe,[t("span",je,d(e.name),1)]),t("div",null,[t("button",{onClick:a=>M(e),class:"btn btn-sm btn-warning btn-outline"},"delete",8,Te)])]))),128))])])])):u("",!0)]))}};export{Ne as _};
