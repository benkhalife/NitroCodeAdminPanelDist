import{h as u,d as e,m as c,z as $,t as y,E as M,q as m,F as z,l as L,G as O,r as V,A as F,n as q,g as d,u as R,x as H,o as Q,B as G,b as k,w as S,k as _,e as I,v as U,c as j,D as K,f as J,j as W}from"./index-DhcoEqlv.js";import{_ as P,a as X,c as Y}from"./MetaTags-BdmyrAdB.js";import{_ as Z}from"./TitleBar-sRY8XcA0.js";import{u as ee}from"./sidebar-Ae4vlIl6.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={name:"FileUploader",emits:["setVideo","setVideoPoster"],props:{uploadLink:{type:String,required:!0},episodeId:{type:[String,Number],required:!0},episode:{required:!0},fetchFilesUrl:{type:String,required:!0}},setup(g){const i=V(null),f=V(!1),l=V([]),b=V([]);let s=[];const o=async()=>{try{const r=await F.post(g.fetchFilesUrl,{episode_id:g.episodeId});r.ok&&Array.isArray(r.files)?b.value=r.files.map(a=>({name:a.name,id:a.name})):b.value=[]}catch(r){console.error("Failed to fetch existing files:",r),b.value=[]}finally{}};o();const x=()=>{i.value.click()},w=r=>{r.preventDefault(),f.value=!0},h=r=>{r.preventDefault(),f.value=!1;const a=Array.from(r.dataTransfer.files);C(a)},T=r=>{const a=Array.from(r.target.files);C(a),r.target.value=""},C=r=>{const a=r.map(p=>({id:Date.now()+Math.random(),name:p.name,size:p.size,file:p,progress:0,status:"pending",error:null}));l.value.push(...a),s.push(...a),s.length===a.length&&D()},D=async()=>{for(;s.length>0;){const r=s[0];await t(r),s.shift(),await q()}await o()},v=(r,a)=>{const p=r.toLowerCase().split(".").pop();return a.indexOf(p)>-1},t=r=>{const a=l.value.findIndex(p=>p.id===r.id);F.uploadFile(g.uploadLink,r.file,{episode_id:g.episodeId},p=>{a!==-1&&(l.value[a]={...l.value[a],progress:parseInt(p)})},p=>{console.log("resp",p),p.ok&&p.status?a!==-1&&(l.value[a]={...l.value[a],status:"success",progress:100}):a!==-1&&(l.value[a]={...l.value[a],status:"error",error:p.error||"Upload failed"})},()=>{a!==-1&&(l.value[a]={...l.value[a],status:"error",error:"Network error occurred"})})};return{fileInput:i,isDragging:f,files:l,triggerFileInput:x,handleDragOver:w,handleDrop:h,handleFileSelect:T,formatBytes:(r,a=2)=>{if(r===0)return"0 Bytes";const p=1024,E=a<0?0:a,N=["Bytes","KB","MB","GB"],A=Math.floor(Math.log(r)/Math.log(p));return parseFloat((r/Math.pow(p,A)).toFixed(E))+" "+N[A]},existingFiles:b,fileTypeIs:v,importantFormats:r=>{const a=["mp4","png","jpg","mpd"],p=r.toLowerCase().split(".").pop();return console.log(r,p),a.indexOf(p)>-1}}}},le={class:"w-full max-w-2xl mx-auto"},oe={class:"flex flex-col items-center justify-center space-y-3"},ie={class:"text-sm text-gray-500 mt-1"},ae={key:0,class:"mt-6 space-y-3",dir:"ltr"},ne={class:"flex items-center justify-between"},re={class:"flex items-center space-x-3 flex-1"},de={class:"flex-1"},ue={class:"font-medium text-gray-800 truncate max-w-xs"},pe={class:"text-sm text-gray-500 flex gap-4"},ve={key:0},me={class:"flex-1"},ce=["value"],ge={class:"flex items-center space-x-2"},fe={key:0,class:"w-8 h-8"},_e={key:1,class:"w-8 h-8"},ye={key:2,class:"w-8 h-8"},be={key:0,class:"mt-3"},xe={class:"w-full bg-gray-200 rounded-full h-2"},we={key:1,class:"mt-2 text-red-500 text-sm"},he={key:1,class:"mt-8",dir:"ltr"},ke={class:"space-y-2"},Ve={class:"flex items-center space-x-3"},Fe={class:"font-medium text-gray-700 truncate"},$e={key:0},Ce=["onClick"],De={key:1},Be=["onClick"],Me={class:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-4"},Se={class:"flex items-center space-x-3"},Ie={class:"font-medium text-sm text-gray-700 truncate"};function Te(g,i,f,l,b,s){return d(),u("div",le,[e("div",{class:m(["relative border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all duration-300",{"border-blue-500 bg-blue-50":l.isDragging,"border-gray-300 hover:border-gray-400 hover:bg-gray-50":!l.isDragging}]),onDragover:i[1]||(i[1]=M((...o)=>l.handleDragOver&&l.handleDragOver(...o),["prevent"])),onDragenter:i[2]||(i[2]=M(o=>l.isDragging=!0,["prevent"])),onDragleave:i[3]||(i[3]=M(o=>l.isDragging=!1,["prevent"])),onDrop:i[4]||(i[4]=M((...o)=>l.handleDrop&&l.handleDrop(...o),["prevent"])),onClick:i[5]||(i[5]=(...o)=>l.triggerFileInput&&l.triggerFileInput(...o))},[e("input",{ref:"fileInput",type:"file",multiple:"",class:"hidden",onChange:i[0]||(i[0]=(...o)=>l.handleFileSelect&&l.handleFileSelect(...o))},null,544),e("div",oe,[i[7]||(i[7]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),e("div",null,[i[6]||(i[6]=e("p",{class:"font-medium text-gray-700"},[e("span",{class:"text-blue-600 font-semibold"},"Click to upload"),$(" or drag and drop ")],-1)),e("p",ie," Supports multiple files ("+y(l.files.length)+" selected) ",1)])])],34),l.files.length>0?(d(),u("div",ae,[(d(!0),u(z,null,L(l.files,(o,x)=>(d(),u("div",{key:o.id,class:"border rounded-lg p-4 bg-white shadow-sm"},[e("div",ne,[e("div",re,[i[8]||(i[8]=e("div",{class:"bg-gray-100 p-2 rounded-lg"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e("div",de,[e("p",ue,y(o.name),1),e("div",pe,[e("div",null,[e("span",null,y(l.formatBytes(o.size)),1)]),o.progress>0?(d(),u("div",ve,[e("span",null,y(o.progress)+"%",1)])):c("",!0),e("div",me,[e("progress",{class:"progress progress-primary w-full",value:o.progress,max:"100"},null,8,ce)])])])]),e("div",ge,[o.status==="uploading"?(d(),u("div",fe,i[9]||(i[9]=[e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"},null,-1)]))):o.status==="error"?(d(),u("div",_e,i[10]||(i[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)]))):o.status==="success"?(d(),u("div",ye,i[11]||(i[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)]))):c("",!0)])]),o.status==="uploading"?(d(),u("div",be,[e("div",xe,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:O({width:o.progress+"%"})},null,4)])])):c("",!0),o.status==="error"?(d(),u("div",we,y(o.error),1)):c("",!0)]))),128))])):c("",!0),l.existingFiles.length>0||g.loadingExisting?(d(),u("div",he,[i[13]||(i[13]=e("h3",{class:"text-lg font-medium text-gray-200 mb-3"},"Uploaded Files",-1)),e("div",ke,[(d(!0),u(z,null,L(l.existingFiles.filter(o=>l.importantFormats(o.name)===!0),(o,x)=>(d(),u("div",{key:o.id||o.name,class:"p-3 bg-gray-50 rounded-lg border flex flex-col gap-4"},[e("div",Ve,[i[12]||(i[12]=e("div",{class:"bg-gray-200 p-2 rounded"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e("span",Fe,y(o.name),1)]),l.fileTypeIs(o.name,["mpd","mp4"])?(d(),u("div",$e,[e("button",{onClick:w=>g.$emit("setVideo",o),class:m([{"btn-primary":o.name==f.episode.video_target},"btn btn-sm"])},"Set Video",10,Ce)])):c("",!0),l.fileTypeIs(o.name,["png","jpg"])?(d(),u("div",De,[e("button",{onClick:w=>g.$emit("setVideoPoster",o),class:m([{"btn-primary":o.name==f.episode.video_poster},"btn btn-sm"])},"Set Video Poster",10,Be)])):c("",!0)]))),128)),e("div",Me,[(d(!0),u(z,null,L(l.existingFiles.filter(o=>l.importantFormats(o.name)===!1),(o,x)=>(d(),u("div",{key:o.id||o.name,class:"p-3 bg-gray-50 rounded-lg border opacity-50"},[e("div",Se,[e("span",Ie,y(o.name),1)])]))),128))])])])):c("",!0)])}const ze=te(se,[["render",Te]]),Le={class:"mr-auto flex gap-4 items-center"},Ue={role:"tablist",class:"tabs tabs-box"},je=["src"],Ae={key:0,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},Pe={class:"w-full flex flex-col gap-4 rounded-lg bg-base-200 p-2 lg:p-4"},Ee={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ne={class:"fieldset"},Oe={class:"border border-primary p-4 rounded-xl bg-base-100"},qe={class:"flex gap-4 justify-start mt-4"},Re={key:0,class:"mt-6"},He={class:"fieldset"},Qe={class:"border border-primary p-4 rounded-xl bg-base-100"},Ge={class:"flex gap-4 justify-start mt-4"},Ke={key:0,class:"p-2 rounded-xl mt-4 bg-green-500/10 text-green-700",dir:"auto"},Je={class:"fieldset"},We={class:"grid grid-cols-1 md:grid-cols-3"},Xe={class:"fieldset bg-base-100 border-base-300 rounded-box w-64 border p-4 lg:mt-auto w-full"},Ye={class:"label"},Ze=["checked"],et={class:"text-center"},tt={key:1,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},st={key:2,class:"flex gap-4 lg:items-start flex-col lg:flex-row w-full mt-4 py-4"},rt={__name:"ProductEpisodeManageView",setup(g){const i=ee(),f=R(),l=H(),b=J(),s=V({}),o=V({title:""}),x=async()=>{const v=await F.post("admin/product/info",{id:l.params.product_id});v.ok&&(o.value=v.product,l.name!="admin_product_episode_new"&&w())},w=async()=>{const v=await F.post("admin/product/episode-info",{episode_id:l.params.episode_id});v.ok&&(s.value=v.episode)},h=async()=>{const v=await F.post("admin/product/episode-save",{...s.value,product_id:l.params.product_id});v.ok&&(f.showToast("عملیات با موفقیت انجام شد!","success"),l.name=="admin_product_episode_new"&&(await b.push({name:"admin_product_episode_edit",params:{product_id:l.params.product_id,episode_id:v.episode_id}}),w()))};l.name=="admin_product_episode_new"?i.setTitle("ایجاد قسمت جدید"):i.setTitle("ویرایش قسمت");const T=v=>{s.value.video_target=v.name,h()},C=v=>{s.value.video_poster=v.name,h()};Q(()=>{x()});const D=G(()=>`\`\`\` 
<h1>${s.value.title}</h1> <br> ${s.value.description} 
 \`\`\` 
---
  
`);return(v,t)=>{const B=W("RouterLink");return d(),u("div",null,[k(Z,{title:_(i).getTitle+" - ("+o.value.title+")"},{default:S(()=>[e("div",Le,[e("div",Ue,[k(B,{to:{hash:""},role:"tab",class:m(["tab",{"tab-active tab-primary":_(l).hash==""}])},{default:S(()=>t[19]||(t[19]=[$(" اطلاعات کلی ")])),_:1,__:[19]},8,["class"]),k(B,{to:{hash:"#meta"},class:m([{"tab-active":_(l).hash=="#meta"},"tab"]),role:"tab"},{default:S(()=>t[20]||(t[20]=[$(" متا تگ‌ها ")])),_:1,__:[20]},8,["class"]),k(B,{to:{hash:"#videos"},class:m([{"tab-active":_(l).hash=="#videos"},"tab"]),role:"tab"},{default:S(()=>t[21]||(t[21]=[$(" ویدیو ")])),_:1,__:[21]},8,["class"])]),e("img",{src:_(F).server+o.value.image,class:"size-10 rounded-xl",alt:""},null,8,je)])]),_:1},8,["title"]),_(l).hash==""?(d(),u("div",Ae,[e("div",Pe,[e("div",Ee,[e("fieldset",Ne,[t[22]||(t[22]=e("legend",{class:"fieldset-legend"},"عنوان قسمت دوره",-1)),I(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>s.value.title=n),class:"input input-primary w-full",type:"text",placeholder:"عنوان محصول"},null,512),[[U,s.value.title]])]),k(P,{title:"لینک قسمت","site-domain":"/","ai-use-type":"link_generator","ai-input":s.value.title,modelValue:s.value.link,"onUpdate:modelValue":t[1]||(t[1]=n=>s.value.link=n)},null,8,["ai-input","modelValue"])]),e("div",{class:m({"opacity-70":s.value.display_status==="introduction"})},[k(P,{maxlength:140,title:"توضیح کوتاه","ai-use-type":"small_description","ai-input":D.value,modelValue:s.value.small_description,"onUpdate:modelValue":t[2]||(t[2]=n=>s.value.small_description=n)},null,8,["ai-input","modelValue"])],2),e("div",{class:m({"opacity-70":s.value.display_status==="introduction"})},[t[23]||(t[23]=e("legend",{class:"fieldset-legend"},"توضیحات",-1)),(d(),j(X,{key:s.value.id,value:s.value.description,onInput:t[3]||(t[3]=n=>s.value.description=n)},null,8,["value"]))],2),e("div",Oe,[t[25]||(t[25]=e("div",null," نوع ارائه این قسمت : ",-1)),e("div",qe,[e("button",{class:m([`${s.value.display_status==="introduction"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[4]||(t[4]=n=>s.value.display_status="introduction")}," معرفی دوره ",2),e("button",{class:m([`${s.value.display_status==="free"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[5]||(t[5]=n=>s.value.display_status="free")},"رایگان",2),e("button",{class:m([`${s.value.display_status==="free_with_login"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[6]||(t[6]=n=>s.value.display_status="free_with_login")}," رایگان با لاگین ",2),e("button",{class:m([`${s.value.display_status==="vip_preview"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[7]||(t[7]=n=>s.value.display_status="vip_preview")}," خرید+پیش‌نمایش ",2),e("button",{class:m([`${s.value.display_status==="vip"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[8]||(t[8]=n=>s.value.display_status="vip")}," خرید ",2)]),s.value.display_status=="vip_preview"?(d(),u("div",Re,[e("fieldset",He,[t[24]||(t[24]=e("legend",{class:"fieldset-legend"},"مدت زمان پیش نمایش رایگان (به ثانیه)",-1)),I(e("input",{"onUpdate:modelValue":t[9]||(t[9]=n=>s.value.free_demo_time=n),class:"input input-primary w-full",type:"number",placeholder:""},null,512),[[U,s.value.free_demo_time]])])])):c("",!0)]),e("div",Qe,[t[26]||(t[26]=e("div",null," نوع ویدیو : ",-1)),e("div",Ge,[e("button",{class:m([`${s.value.video_type==="dash"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[10]||(t[10]=n=>s.value.video_type="dash")},"DASH",2),e("button",{class:m([`${s.value.video_type==="mp4"?"":"btn-outline"}`,"btn btn-primary"]),onClick:t[11]||(t[11]=n=>s.value.video_type="mp4")},"mp4",2)]),s.value.video_target?(d(),u("div",Ke,y(s.value.video_target),1)):c("",!0)]),e("div",null,[e("fieldset",Je,[t[27]||(t[27]=e("legend",{class:"fieldset-legend"},"جاییگاه (برای مرتب سازی) (به صورت عدد 0 تا 100)",-1)),I(e("input",{"onUpdate:modelValue":t[12]||(t[12]=n=>s.value.sort_index=n),class:"input input-primary w-full",type:"text",placeholder:""},null,512),[[U,s.value.sort_index]])])]),e("div",We,[e("fieldset",Xe,[e("label",Ye,[I(e("input",{type:"checkbox","onUpdate:modelValue":t[13]||(t[13]=n=>s.value.publish=n),checked:s.value.publish,class:"checkbox checkbox-success"},null,8,Ze),[[K,s.value.publish]]),t[28]||(t[28]=$(" انتشار "))])])]),e("div",et,[e("button",{onClick:t[14]||(t[14]=n=>h()),class:"btn btn-success"}," ذخیره قسمت ")])])])):c("",!0),_(l).hash=="#meta"?(d(),u("div",tt,[s.value.id?(d(),j(Y,{key:0,modelValue:s.value,"onUpdate:modelValue":t[15]||(t[15]=n=>s.value=n),"ai-input":D.value,onSave:t[16]||(t[16]=n=>h())},null,8,["modelValue","ai-input"])):c("",!0)])):c("",!0),_(l).hash=="#videos"?(d(),u("div",st,[s.value.id?(d(),j(ze,{key:0,onSetVideoPoster:t[17]||(t[17]=n=>C(n)),onSetVideo:t[18]||(t[18]=n=>T(n)),"fetch-files-url":"get-episode-files",episode:s.value,"episode-id":s.value.id,"upload-link":"admin/product/upload-episode-video"},null,8,["episode","episode-id"])):c("",!0)])):c("",!0)])}}};export{rt as default};
