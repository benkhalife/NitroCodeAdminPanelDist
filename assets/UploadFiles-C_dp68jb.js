import{h as r,g as o,d as t,r as m,J as F,m as d,G as Q,t as u,O as _,q as x,F as S,l as B,b as z,k as I,A as C,S as R}from"./index-DYZIYozw.js";import{r as W}from"./PencilIcon-2xjamxOz.js";function X(v,L){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z","clip-rule":"evenodd"})])}const Y={class:"w-full max-w-2xl mx-auto"},ee={class:"flex flex-col items-center justify-center space-y-3"},te={class:"text-sm text-gray-500 mt-1"},se={key:0,class:"text-sm text-blue-500 mt-1"},ne={key:0,class:"mt-6 space-y-3",dir:"ltr"},re={class:"flex items-center justify-between"},oe={class:"flex items-center space-x-3 flex-1"},le={class:"flex-1"},ae={class:"font-medium text-gray-800 truncate max-w-xs"},ie={class:"text-sm text-gray-500 flex gap-4"},de={key:0},ue={class:"flex-1"},ce=["value"],pe={class:"flex items-center space-x-2"},me={key:0,class:"w-8 h-8"},ve={key:1,class:"w-8 h-8"},ge={key:2,class:"w-8 h-8"},be={key:0,class:"mt-2 text-red-500 text-sm"},he={key:1,class:"mt-4 flex gap-2"},xe={key:2,class:"mt-4 p-4 bg-blue-50 rounded-lg"},we={class:"flex items-center justify-between"},fe={class:"text-sm text-blue-600"},ke={key:3,class:"mt-8",dir:"ltr"},ye={class:"space-y-2"},_e={class:"flex items-center space-x-3"},Ce={key:0,class:"flex items-center gap-4"},Fe={class:"font-medium text-gray-700 truncate"},Se=["onClick"],Be={key:1,class:"flex items-center gap-2"},Ue=["value","onInput"],$e=["onClick"],Ve={class:"flex gap-4 justify-end"},Me=["onClick"],ze=["onClick"],Ie=["onClick"],Le=["onClick"],Ae=["onClick"],De=["onClick"],Pe=["onClick"],Ee={class:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-4"},je={class:"flex items-center space-x-3"},Te={class:"font-medium text-sm text-gray-700 truncate"},qe=["onClick"],Ge={__name:"UploadFiles",props:{uploadLink:{type:String,required:!0},episode:{required:!0},fetchFilesUrl:{type:String,required:!0},deleteFileUrl:{type:String,required:!0,default:"admin/product/delete-episode-file"},renameFileUrl:{default:""}},emits:["setVideo","setVideoPoster"],setup(v,{emit:L}){const c=v,U=m(null),g=m(!1),l=m([]),b=m([]),p=m(!1),w=m(-1),k=m(!1),A=F(()=>l.value.filter(s=>s.status==="pending").length),D=F(()=>l.value.filter(s=>s.status==="success").length),P=F(()=>l.value.filter(s=>s.status==="error").length),y=async()=>{try{const s=await C.post(c.fetchFilesUrl,{id:c.episode.id});s.ok&&Array.isArray(s.files)?b.value=s.files.map(n=>({name:n.name,id:n.name})):b.value=[]}catch(s){console.error("Failed to fetch existing files:",s),b.value=[]}};y();const E=async s=>{s.edit_name=!1,s.new_name&&(await C.post(c.renameFileUrl,{...s,...c.episode}),y())},j=()=>{U.value.click()},T=s=>{s.preventDefault(),g.value=!0},q=s=>{s.preventDefault(),g.value=!1;const n=Array.from(s.dataTransfer.files);$(n)},N=s=>{const n=Array.from(s.target.files);$(n),s.target.value=""},$=s=>{const n=s.map(e=>({id:Date.now()+Math.random(),name:e.name,size:e.size,file:e,progress:0,status:"pending",error:null}));l.value.push(...n)},O=async()=>{if(p.value)return;p.value=!0,k.value=!1,w.value=-1;const s=l.value.filter(n=>n.status==="pending");for(let n=0;n<s.length&&!k.value;n++){w.value=l.value.findIndex(e=>e.id===s[n].id);try{await H(s[n])}catch(e){console.error("Upload stopped due to error:",e);break}await new Promise(e=>setTimeout(e,100))}p.value=!1,w.value=-1,k.value||await y()},G=()=>{k.value=!0,p.value=!1},H=s=>new Promise((n,e)=>{const i=l.value.findIndex(a=>a.id===s.id);if(i===-1){e(new Error("File not found"));return}l.value[i]={...l.value[i],status:"uploading",progress:0},C.uploadFile(c.uploadLink,s.file,{id:c.episode.id},a=>{i!==-1&&(l.value[i]={...l.value[i],progress:parseInt(a)})},a=>{if(console.log("resp",a),a.ok&&a.status)l.value[i]={...l.value[i],status:"success",progress:100},n(a);else{const f=a.error||"Upload failed";l.value[i]={...l.value[i],status:"error",error:f},e(new Error(f))}},a=>{l.value[i]={...l.value[i],status:"error",error:"Network error occurred"},e(new Error("Network error occurred"))})}),Z=()=>{l.value=l.value.filter(s=>s.status==="pending")},J=()=>{l.value=[]},h=(s,n)=>{const e=s.toLowerCase().split(".").pop();return n.indexOf(e)>-1},K=(s,n=2)=>{if(s===0)return"0 Bytes";const e=1024,i=n<0?0:n,a=["Bytes","KB","MB","GB"],f=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,f)).toFixed(i))+" "+a[f]},V=s=>{const n=["mp4","mp3","m4a","png","jpg","mpd","webp","vtt","str"],e=s.toLowerCase().split(".").pop();return n.indexOf(e)>-1},M=async s=>{(await R.fire({title:"آیا مطمئن هستید؟",text:`آیا از حذف فایل "${s.name}" اطمینان دارید؟`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"بله، حذف شود",cancelButtonText:"لغو"})).isConfirmed&&(console.log(c.episode),(await C.post(c.deleteFileUrl,{file_name:s.name,id:c.episode.id})).ok&&y())};return(s,n)=>(o(),r("div",Y,[t("div",{class:x(["relative border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all duration-300",{"border-blue-500 bg-blue-50":g.value,"border-gray-300 hover:border-gray-400 hover:bg-gray-50":!g.value}]),onDragover:_(T,["prevent"]),onDragenter:n[0]||(n[0]=_(e=>g.value=!0,["prevent"])),onDragleave:n[1]||(n[1]=_(e=>g.value=!1,["prevent"])),onDrop:_(q,["prevent"]),onClick:j},[t("input",{ref_key:"fileInput",ref:U,type:"file",multiple:"",class:"hidden",onChange:N},null,544),t("div",ee,[n[3]||(n[3]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),t("div",null,[n[2]||(n[2]=t("p",{class:"font-medium text-gray-700"},[t("span",{class:"text-blue-600 font-semibold"},"Click to upload"),Q(" or drag and drop ")],-1)),t("p",te," Supports multiple files ("+u(l.value.length)+" selected) ",1),p.value?(o(),r("p",se," Uploading... "+u(w.value+1)+"/"+u(l.value.length),1)):d("",!0)])])],34),l.value.length>0?(o(),r("div",ne,[(o(!0),r(S,null,B(l.value,(e,i)=>(o(),r("div",{key:e.id,class:x(["border rounded-lg p-4 bg-white shadow-sm",{"border-blue-200 bg-blue-50":e.status==="uploading","border-green-200 bg-green-50":e.status==="success","border-red-200 bg-red-50":e.status==="error"}])},[t("div",re,[t("div",oe,[n[4]||(n[4]=t("div",{class:"bg-gray-100 p-2 rounded-lg"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),t("div",le,[t("p",ae,u(e.name),1),t("div",ie,[t("div",null,[t("span",null,u(K(e.size)),1)]),e.progress>0?(o(),r("div",de,[t("span",null,u(e.progress)+"%",1)])):d("",!0),t("div",ue,[t("progress",{class:"progress progress-primary w-full",value:e.progress,max:"100"},null,8,ce)])])])]),t("div",pe,[e.status==="uploading"?(o(),r("div",me,n[5]||(n[5]=[t("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"},null,-1)]))):e.status==="error"?(o(),r("div",ve,n[6]||(n[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)]))):e.status==="success"?(o(),r("div",ge,n[7]||(n[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-green-500",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)]))):d("",!0)])]),e.status==="error"?(o(),r("div",be,u(e.error),1)):d("",!0)],2))),128))])):d("",!0),l.value.length>0&&!p.value?(o(),r("div",he,[t("button",{onClick:O,class:"btn btn-primary"}," Start Upload ("+u(A.value)+" files) ",1),t("button",{onClick:Z,class:"btn btn-outline"}," Clear Completed "),t("button",{onClick:J,class:"btn btn-outline"}," Clear All ")])):d("",!0),p.value?(o(),r("div",xe,[t("div",we,[t("div",null,[n[8]||(n[8]=t("p",{class:"font-medium text-blue-700"},"Uploading in progress...",-1)),t("p",fe,u(w.value+1)+" of "+u(l.value.length)+" files ("+u(D.value)+" successful, "+u(P.value)+" failed) ",1)]),t("button",{onClick:G,class:"btn btn-sm btn-outline text-red-600"}," Stop Upload ")])])):d("",!0),b.value.length>0?(o(),r("div",ke,[n[10]||(n[10]=t("h3",{class:"text-lg font-medium text-gray-200 mb-3"},"Uploaded Files",-1)),t("div",ye,[(o(!0),r(S,null,B(b.value.filter(e=>V(e.name)===!0),(e,i)=>(o(),r("div",{key:e.id||e.name,class:"p-3 bg-gray-50 rounded-lg border flex flex-col gap-4"},[t("div",_e,[n[9]||(n[9]=t("div",{class:"bg-gray-200 p-2 rounded"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e.edit_name?(o(),r("div",Be,[t("input",{class:"input",value:e.name,onInput:a=>e.new_name=a.target.value,type:"text"},null,40,Ue),t("button",{onClick:a=>E(e),class:"btn btn-circle btn-sm"},[z(I(X),{class:"size-10"})],8,$e)])):(o(),r("div",Ce,[t("span",Fe,u(e.name),1),c.renameFileUrl.length?(o(),r("div",{key:0,onClick:a=>e.edit_name=!e.edit_name,"data-tip":"Edit name",class:"tooltip hover:bg-primary/30 text-primary/50 hover:text-primary p-1 rounded-lg cursor-pointer duration-200"},[z(I(W),{class:"size-4"})],8,Se)):d("",!0)]))]),t("div",Ve,[h(e.name,["mpd","mp4"])?(o(),r("button",{key:0,onClick:a=>s.$emit("setVideo",e),class:x([{"btn-primary":e.name==v.episode.video_target},"btn btn-sm"])}," Set Video ",10,Me)):d("",!0),h(e.name,["mpd","mp4"])?(o(),r("button",{key:1,onClick:a=>s.$emit("setVideoPreview",e),class:x([{"btn-primary":e.name==v.episode.video_preview_target},"btn btn-sm"])}," Set Video Preview ",10,ze)):d("",!0),h(e.name,["png","jpg","webp"])?(o(),r("button",{key:2,onClick:a=>s.$emit("setVideoPoster",e),class:x([{"btn-primary":e.name==v.episode.video_poster},"btn btn-sm"])}," Set Video Poster ",10,Ie)):d("",!0),h(e.name,["mp3","m4a"])?(o(),r("button",{key:3,onClick:a=>s.$emit("setAudio",e),class:x([{"btn-primary":e.name==v.episode.audio},"btn btn-sm"])}," Set Post Audio ",10,Le)):d("",!0),h(e.name,["vtt","str"])?(o(),r("button",{key:4,onClick:a=>s.$emit("setSubtitle",{file:e.name,srclang:"en",label:"English"}),class:"btn btn-sm"}," Set Subtitle En ",8,Ae)):d("",!0),h(e.name,["vtt","str"])?(o(),r("button",{key:5,onClick:a=>s.$emit("setSubtitle",{file:e.name,srclang:"fa",label:"Farsi/فارسی"}),class:"btn btn-sm"}," Set Subtitle Fa ",8,De)):d("",!0),t("button",{onClick:a=>M(e),class:"btn btn-sm btn-warning btn-outline"},"delete",8,Pe)])]))),128)),t("div",Ee,[(o(!0),r(S,null,B(b.value.filter(e=>V(e.name)===!1),(e,i)=>(o(),r("div",{key:e.id||e.name,class:"p-3 bg-gray-50 rounded-lg border opacity-50"},[t("div",je,[t("span",Te,u(e.name),1)]),t("div",null,[t("button",{onClick:a=>M(e),class:"btn btn-sm btn-warning btn-outline"},"delete",8,qe)])]))),128))])])])):d("",!0)]))}};export{Ge as _};
